<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MiningPRO - Kontrol Paneli</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">

<style>
/* --- GENEL STÄ°LLER --- */
body, html{ margin:0; padding:0; font-family: 'Roboto', sans-serif; background: #121212; color:#e0e0e0; min-height:100vh; padding-bottom: 70px; }
* { box-sizing: border-box; }

header{ background:#1f1f1f; padding:15px; text-align:center; font-size:28px; font-weight:900; color:#00e676; text-shadow: 0 0 10px rgba(0, 230, 118, 0.4); box-shadow:0 5px 15px rgba(0,0,0,0.6); position:sticky; top:0; z-index:100;}
header i { margin-right: 10px; color:#00b0ff; }
.wrapper{ max-width:550px; margin:20px auto; padding:0 15px; }

/* KARTLAR */
.card, .exchange-panel, .footer-info { background:#1f1f1f; border-radius:15px; padding:25px; margin-bottom:25px; box-shadow:0 6px 20px rgba(0,0,0,0.5); border: 1px solid #333; }
.card h2 { color: #00b0ff; font-size: 22px; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; font-weight: 700; }
.card h3 { color: #e0e0e0; font-size: 17px; margin-top: 15px; margin-bottom: 10px; font-weight: 700; }

/* INPUT */
select{ width:100%; padding:14px; font-size:16px; border-radius:10px; border:2px solid #ff9800; background:#121212; color:#e0e0e0; font-weight: 700; transition: border-color 0.3s;}
.select-wrapper { position: relative; }
.select-wrapper::after { content: '\f078'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #ff9800; pointer-events: none;}

/* --- CÄ°HAZ VE ANÄ°MASYON --- */
@keyframes pulse {
    0% { box-shadow: inset 0 0 10px rgba(0, 230, 118, 0.4), 0 0 10px rgba(0, 230, 118, 0.6); }
    50% { box-shadow: inset 0 0 30px rgba(0, 230, 118, 0.8), 0 0 30px rgba(0, 230, 118, 1); }
    100% { box-shadow: inset 0 0 10px rgba(0, 230, 118, 0.4), 0 0 10px rgba(0, 230, 118, 0.6); }
}
.mining-area{ margin:20px 0; height:180px; display:flex; justify-content:center; align-items:center; background:#121212; border-radius:15px; border: 4px solid #00e676; animation: none;}

#hardwareIcon {
    color: #00e676; 
    text-shadow: 0 0 20px #00e676;
    font-size: 100px;
    animation: none; 
}

.status-msg{ text-align:center; font-weight:700; margin-bottom:15px; padding: 10px; border-radius: 8px; font-size: 18px;}

/* --- HASH BAR VE BUTONLAR --- */
.hash-bar{ width:100%; height:25px; background:#333; border-radius:12px; overflow:hidden;}
.hash-fill{ height:100%; width:0%; background:linear-gradient(90deg, #00e676, #ff9800); transition:width .5s ease-out;}
.countdown{ text-align:center; margin-top:20px; font-size:26px; font-weight:900; color:#ff9800; text-shadow: 0 0 5px rgba(255, 152, 0, 0.4);}
.button-container { display: flex; gap: 15px; margin-top: 25px;}
.main-action-button{ flex-grow: 1; padding:15px; border:none; border-radius:10px; font-weight:900; font-size:17px; color:#121212; cursor:pointer; transition: all .3s;}
#startBtn { background:#00e676; box-shadow:0 4px 15px rgba(0, 230, 118, 0.4);}
#stopBtn { background: #ff0057; box-shadow: 0 4px 15px rgba(255, 0, 87, 0.4); display: none;}

/* Bakiye ve AktarÄ±m Butonu */
.balance-container{ background:#2a2a2a; border-radius:10px; padding:20px; margin-top:25px; font-weight:700; border: 2px solid #00b0ff; display: flex; justify-content: space-between; align-items: center; font-size: 16px;}
.balance-container strong { color: #ff9800; font-size: 24px; margin-left: 8px; }
#transferBtn { background: #ff9800; color: #121212; box-shadow: 0 3px 10px rgba(255, 152, 0, 0.4); padding: 10px 15px; font-size: 15px; font-weight: 700;}

/* HIZ SEÃ‡Ä°MÄ° */
.accordion-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px dashed #333; cursor: pointer; color: #00e676; font-size: 18px; font-weight: 700;}
.speed-item { display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #2a2a2a; border-radius: 8px; font-weight: 700; border: 2px solid transparent; cursor: pointer; flex-wrap: wrap; margin-bottom: 8px;}
.activation-area { display: flex; gap: 10px; margin-top: 10px; width: 100%; align-items: center;}
.activation-area input { flex-grow: 1; padding: 8px; border-radius: 5px; border: 1px solid #ff9800; background: #121212; color: #e0e0e0; font-weight: 500; font-size: 14px;}
.activation-area button { background: #00b0ff; color: white; padding: 8px 15px; border-radius: 5px; font-size: 14px; font-weight: 700;}

/* DÄ°ÄER */
.bottom-menu { position:fixed; bottom:0; left:0; width:100%; display:flex; justify-content:space-around; background:#161b22; padding:10px 0; box-shadow:0 -3px 10px rgba(0,0,0,0.4); z-index:99;}
.bottom-menu a { flex:1; text-align: center; margin:0 5px; padding:8px 0; font-size:12px; color:#777; font-weight: 600; }
.bottom-menu a i { font-size: 20px; display: block; margin-bottom: 4px; }
.bottom-menu a.active { color:#00bfff; }

#floatingAlert { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; padding: 15px 25px; border-radius: 10px; font-weight: 700; color: #121212; box-shadow: 0 5px 20px rgba(0,0,0,0.4); opacity: 0; pointer-events: none;}
.alert-success { background: #00e676; }
.alert-error { background: #ff0057; }
</style>
</head>
<body>

<div id="floatingAlert" class="alert-info"></div>

<div class="wrapper" id="appContent">
    <header><i class="fas fa-server"></i> MiningPRO</header>
  
    <div class="card">
      <div class="accordion-header" id="settingsHeader">
          âš™ï¸ Cihaz ve KazÄ±m AyarlarÄ±
          <i class="fas fa-chevron-down"></i>
      </div>
      
      <div class="accordion-content open" id="settingsContent">
          <div class="input-group">
              <label for="cryptoDropdown">KazÄ±m BaÅŸlatÄ±lacak Kripto:</label>
              <div class="select-wrapper">
                  <select id="cryptoDropdown">
                      <option value="">-- Hedef Kriptoyu SeÃ§in --</option>
                      <option value="BTC">Bitcoin (BTC)</option>
                      <option value="ETH">Ethereum (ETH)</option>
                      <option value="USDT">Tether (USDT)</option>
                      <option value="BNB">Binance Coin (BNB)</option>
                      <option value="TRX">Tron (TRX)</option>
                      <option value="DOGE">Dogecoin (DOGE)</option>
                      <option value="TON">TON (The Open Network)</option>
                  </select>
              </div>
          </div>
      
          <h3>DonanÄ±m Ã‡arpanÄ± (Aktif SÃ¼re: GÃ¼n)</h3>
          <div class="speed-options" id="fanSpeedOptions">
              <div class="speed-item active" data-speed="5" data-duration="SÃ¼resiz">
                  <label><input type="radio" name="fanSpeed" value="5" checked> Standart HÄ±z (5x)</label>
              </div>
              <div class="speed-item locked" data-speed="7" data-duration="10 GÃ¼n">
                  <label><input type="radio" name="fanSpeed" value="7" disabled> YÃ¼ksek HÄ±z (7x)</label>
                  <div class="activation-area">
                     <input type="text" maxlength="8" placeholder="8 Haneli Aktivasyon Key'i">
                     <button onclick="activateSpeed(7, this)">AKTÄ°F ET</button>
                  </div>
              </div>
              <div class="speed-item locked" data-speed="10" data-duration="20 GÃ¼n">
                  <label><input type="radio" name="fanSpeed" value="10" disabled> Uzman HÄ±z (10x)</label>
                  <div class="activation-area">
                     <input type="text" maxlength="8" placeholder="8 Haneli Aktivasyon Key'i">
                     <button onclick="activateSpeed(10, this)">AKTÄ°F ET</button>
                  </div>
              </div>
              <div class="speed-item locked" data-speed="15" data-duration="30 GÃ¼n">
                  <label><input type="radio" name="fanSpeed" value="15" disabled> Ultra HÄ±z (15x)</label>
                  <div class="activation-area">
                     <input type="text" maxlength="8" placeholder="8 Haneli Aktivasyon Key'i">
                     <button onclick="activateSpeed(15, this)">AKTÄ°F ET</button>
                  </div>
              </div>
              <div class="speed-item locked" data-speed="20" data-duration="30 GÃ¼n">
                  <label><input type="radio" name="fanSpeed" value="20" disabled> Maksimum HÄ±z (20x)</label>
                  <div class="activation-area">
                     <input type="text" maxlength="8" placeholder="8 Haneli Aktivasyon Key'i">
                     <button onclick="activateSpeed(20, this)">AKTÄ°F ET</button>
                  </div>
              </div>
          </div>
      </div> </div>
    <div id="selectMsg" class="status-msg" style="color:#ff9800;">LÃ¼tfen kazÄ±m yapmak istediÄŸiniz kripto parayÄ± seÃ§in.</div>
    
    <div class="card" id="miningTab">
      <h2><i class="fas fa-cogs"></i> Aktif KazÄ±m Durumu</h2>
      <div id="miningStatusMessage" class="status-msg" style="background:#333; color:#ff0057;">KazÄ±m KapalÄ±. DonanÄ±m BoÅŸta.</div>
      
      <div class="mining-area" id="miningArea">
          <i id="hardwareIcon" class="fas fa-server"></i> 
      </div>
      
      <div class="hash-container">
        <div class="hash-bar"><div class="hash-fill" id="hashFill"></div></div>
        <div class="hash-text" id="hashText">Aktif Hash GÃ¼cÃ¼: 0 KH/s (Ã‡arpan: 5x)</div>
      </div>
      
      <div class="countdown" id="countdown">KazÄ±m BaÅŸlatÄ±lmayÄ± Bekliyor</div>
      
      <div class="button-container">
        <button id="startBtn" class="main-action-button"><i class="fas fa-play"></i> BaÅŸlat</button>
        <button id="stopBtn" class="main-action-button"><i class="fas fa-stop"></i> Durdur</button>
      </div>
    
      <div class="balance-container">
          <span>Biriken Bakiye: <strong id="currentMiningBalance">0.00000</strong></span>
          <button id="transferBtn" disabled><i class="fas fa-exchange-alt"></i> CÃ¼zdana Aktar</button>
      </div>
    
      <h3>CanlÄ± KazanÃ§ Ä°ÅŸlemleri</h3>
      <div class="feed-box" id="feedBox"></div>
    </div>
    
    <div class="card" id="walletTab">
        <h2><i class="fas fa-wallet"></i> KullanÄ±labilir Bakiye</h2>
        <div class="balance-container" style="border-color:#00e676; background:#2a2a2a;">
            Toplam DeÄŸer (USD KarÅŸÄ±lÄ±ÄŸÄ±): <strong id="totalBalanceWallet">$0.00</strong>
        </div>
        <div id="individualBalances" style="margin-top:15px; padding:10px; border:1px dashed #333;">
            </div>
    </div>
    
    <div class="exchange-panel" id="exchangePanel">
        <h2><i class="fas fa-chart-line"></i> AnlÄ±k Kripto PiyasasÄ±</h2>
        <div class="exchange-item exchange-header">
            <span>Kripto</span>
            <span style="text-align:right;">Fiyat (USD)</span>
            <span style="text-align:right;">DeÄŸiÅŸim (24s)</span>
        </div>
        <div id="liveExchangeRates">
            <p style="text-align:center; color:#ccc;">Veriler yÃ¼kleniyor...</p>
        </div>
    </div>
    
    <div class="marquee-container">
        <div class="marquee-content">
            <span>âœ… Veri AkÄ±ÅŸÄ± GerÃ§ek ZamanlÄ±</span>
            <span>ğŸ”‘ Yeni HÄ±z Key'leri Ä°Ã§in CÃ¼zdanÄ±nÄ±zÄ± Kontrol Edin</span>
            <span>ğŸ›¡ï¸ GÃ¼venlik Protokolleri Aktif: Veri Åifreleme</span>
            <span>ğŸš€ DonanÄ±m Ã‡arpanÄ±nÄ±zÄ± YÃ¼kseltin ve KazancÄ±nÄ±zÄ± KatlayÄ±n</span>
        </div>
    </div>
    
    <div class="footer-info">
        <h3>ğŸ“ BaÅŸlangÄ±Ã§ KÄ±lavuzu</h3>
        <p>MiningPRO, tamamen gÃ¼venli, yerel depolama tabanlÄ± bir kontrol aracÄ±dÄ±r. BaÅŸlamak iÃ§in:</p>
        <ol>
            <li>Hedef **Kripto** (Ã–rn: BTC, ETH) seÃ§imi yapÄ±n.</li>
            <li>Ä°stediÄŸiniz **HÄ±z Ã‡arpanÄ±nÄ±** seÃ§in.</li>
            <li>**"BaÅŸlat"** butonuna tÄ±klayÄ±n.</li>
        </ol>
        
        <div class="spacer"></div>
    
        <h3>ğŸ›¡ï¸ Gizlilik ve GÃ¼venlik</h3>
        <p>TÃ¼m uygulama verileri (Bakiye, HÄ±z SeÃ§imleri, KazÄ±m Durumu) **yalnÄ±zca cihazÄ±nÄ±zÄ±n yerel depolama alanÄ±nda** saklanÄ±r. Harici sunucuya veri gÃ¶nderilmez (Firebase baÄŸlantÄ±sÄ± sadece kullanÄ±cÄ± yetkilendirmesi iÃ§indir).</p>
        
        <div class="spacer"></div>
    
        <h3>ğŸ¤ OrtaklÄ±k ve Destek</h3>
        <p>Destek ve iÅŸbirlikleri iÃ§in: support@miningpro.tech</p>
    </div>
</div>


<div class="bottom-menu" id="bottomMenu">
    <a href="#miningTab" class="active"><i class="fas fa-tachometer-alt"></i> KazÄ±m</a>
    <a href="#settingsContent"><i class="fas fa-bolt"></i> HÄ±z Ayar</a>
    <a href="#exchangePanel"><i class="fas fa-chart-line"></i> Piyasalar</a>
    <a href="#walletTab"><i class="fas fa-wallet"></i> CÃ¼zdanÄ±m</a>
</div>

<script>
// =========================================================================
// FIREBASE / GÄ°RÄ°Å KONTROLÃœ (Yer Tutucu)
// =========================================================================

const INDEX_PAGE = "index.html"; 

function checkUserAuthentication() {
    // GerÃ§ek bir uygulamada, burada Firebase auth kontrolÃ¼ yapÄ±lÄ±r.
    // EÄŸer kullanÄ±cÄ± kimlik doÄŸrulamadan geÃ§mediyse veya index.html'den gelmediyse yÃ¶nlendirilir.

    // Basit YÃ¶nlendirme KontrolÃ¼ (index.html'den mi gelindi?)
    if (!document.referrer.includes(INDEX_PAGE)) {
        // showFloatingAlert("Yetkisiz EriÅŸim. LÃ¼tfen giriÅŸ sayfasÄ±ndan ('index.html') giriÅŸ yapÄ±nÄ±z.", 'error', 5000);
        // window.location.href = INDEX_PAGE; 
        
        // Åimdilik sadece uyarÄ± verelim, loop'a girmesin.
        console.warn("KullanÄ±cÄ± index.html'den gelmedi. Normalde burasÄ± giriÅŸ sayfasÄ±na yÃ¶nlendirilir.");
    }
    
    // Firebase KullanÄ±cÄ± Verisi Ã‡ekme (Yer Tutucu)
    // EÄŸer yetkilendirme baÅŸarÄ±lÄ± ise:
    // fetchUserDataFromFirebase(firebase.auth().currentUser.uid).then(data => {
    //      loadAppState(data); 
    // }).catch(() => {
    //      loadAppState(); 
    // });
    
    loadAppState(); // Åimdilik Firebase'den veri Ã§ekmeden direkt LocalStorage'dan yÃ¼kleyelim.
}


// =========================================================================
// YEREL DEPOLAMA VE BAÅLANGIÃ‡ VERÄ°LERÄ°
// =========================================================================

let appState;
let mineInterval;
let countdownInterval;
let priceUpdateInterval;
let alertTimeout;

const MINING_CYCLE_SECONDS = 12 * 60 * 60; // 12 Saat
const DAY_MS = 24 * 60 * 60 * 1000;

// HÄ±z Aktivasyon SÃ¼releri (GÃ¼n olarak)
const KEY_DURATIONS = {
    7: 10,  // 10 GÃ¼n
    10: 20, // 20 GÃ¼n
    15: 30, // 30 GÃ¼n
    20: 30  // 30 GÃ¼n
};

// HÄ±z Aktivasyon AnahtarlarÄ± (8 Haneli)
const KEYS = {
    7: "HIZKEY7X",   
    10: "UZMAN10X",  
    15: "ULTRA15X", 
    20: "MAKS20XG"   
};

const initialData = {
    selectedCrypto: "",
    mining: false,
    hashPower: 1000, 
    countdownTime: MINING_CYCLE_SECONDS, 
    mainBalance: { USDT: 0, BTC: 0, ETH: 0, BNB: 0, TRX: 0, DOGE: 0, TON: 0 }, 
    miningBalance: 0, 
    fanSpeed: 5, 
    purchasedSpeeds: [{ speed: 5, expiry: 0 }] 
};

const CRYPTOS = { 
    USDT: { name: "Tether", emoji: "ğŸ’µ", icon: "fas fa-dollar-sign", color: "#26a69a" }, 
    BTC: { name: "Bitcoin", emoji: "â‚¿", icon: "fab fa-btc", color: "#f7931a" }, 
    ETH: { name: "Ethereum", emoji: "Î", icon: "fab fa-ethereum", color: "#627eea" },
    BNB: { name: "Binance Coin", emoji: "ğŸŸ¡", icon: "fas fa-coins", color: "#f3ba2f" },
    TRX: { name: "Tron", emoji: "ğŸ”´", icon: "fas fa-bolt", color: "#eb0e29" },
    DOGE: { name: "Dogecoin", emoji: "ğŸ•", icon: "fas fa-dog", color: "#c2a633" },
    TON: { name: "TON", emoji: "ğŸ’", icon: "fas fa-gem", color: "#0098ea" },
};

const LIVE_PRICES = {
    USDT: { price: 1.0000, lastPrice: 1.0000, change: 0.00 },
    BTC: { price: 72000, lastPrice: 72000, change: 0.00 }, 
    ETH: { price: 4000, lastPrice: 4000, change: 0.00 },
    BNB: { price: 600, lastPrice: 600, change: 0.00 },
    TRX: { price: 0.12, lastPrice: 0.12, change: 0.00 },
    DOGE: { price: 0.18, lastPrice: 0.18, change: 0.00 },
    TON: { price: 8.00, lastPrice: 8.00, change: 0.00 },
};

const DIFFICULTY = {
    BTC: 150000000, 
    ETH: 80000000,
    USDT: 5000000, 
    BNB: 60000000,
    TRX: 10000000,
    DOGE: 20000000,
    TON: 40000000,
};

const PRICE_UPDATE_INTERVAL = 10000; 

function loadAppState() {
    try {
        const storedData = localStorage.getItem('miningProState');
        if (storedData) {
            const parsedData = JSON.parse(storedData);
            
            let finalSpeeds = parsedData.purchasedSpeeds || initialData.purchasedSpeeds;
            if (finalSpeeds.length === 0 || !finalSpeeds.find(s => s.speed === 5)) {
                 finalSpeeds.push({ speed: 5, expiry: 0 });
            }

            appState = { 
                ...initialData, 
                ...parsedData,
                mainBalance: { ...initialData.mainBalance, ...parsedData.mainBalance },
                purchasedSpeeds: finalSpeeds
            };
        } else {
            appState = { ...initialData };
        }
    } catch (e) {
        console.error("Yerel depolama verisi yÃ¼klenirken hata:", e);
        appState = { ...initialData };
    }
}

function saveAppState() {
    try {
        localStorage.setItem('miningProState', JSON.stringify(appState));
        // GerÃ§ek bir projede, burada Firebase'e de veri gÃ¶nderilebilir.
    } catch (e) {
        console.error("Yerel depolama verisi kaydedilirken hata:", e);
    }
}

// =========================================================================
// HIZ KONTROLÃœ
// =========================================================================

function checkSpeedExpirations() {
    const now = Date.now();
    let speedsToRemove = [];
    let speedChanged = false;

    appState.purchasedSpeeds.forEach(item => {
        if (item.expiry !== 0 && item.expiry < now) {
            speedsToRemove.push(item.speed);
            
            if (item.speed === appState.fanSpeed) {
                appState.fanSpeed = 5;
                showFloatingAlert(`${item.speed}x hÄ±z sÃ¼reniz doldu! HÄ±zÄ±nÄ±z 5x'e dÃ¼ÅŸÃ¼rÃ¼ldÃ¼.`, 'error', 7000);
                speedChanged = true;
            }
        }
    });

    if (speedsToRemove.length > 0) {
        appState.purchasedSpeeds = appState.purchasedSpeeds.filter(item => !speedsToRemove.includes(item.speed));
        
        if (speedChanged) {
            updateHashPowerDisplay();
        }
        saveAppState();
    }
}

window.activateSpeed = function(speed, buttonElement) {
    const durationDays = KEY_DURATIONS[speed];
    const itemEl = buttonElement.closest('.speed-item');
    const inputEl = itemEl.querySelector('input[type="text"]');
    const enteredKey = inputEl.value.toUpperCase().trim();

    if (enteredKey.length !== 8) {
        showFloatingAlert("Aktivasyon Key'i 8 haneli olmalÄ±dÄ±r.", 'error');
        return;
    }
    
    if (KEYS[speed] === enteredKey) {
        const expiryTime = Date.now() + (durationDays * DAY_MS);
        
        const existingSpeed = appState.purchasedSpeeds.find(s => s.speed === speed);
        if (existingSpeed) {
            existingSpeed.expiry = expiryTime;
        } else {
            appState.purchasedSpeeds.push({ speed, expiry: expiryTime });
        }
        
        appState.fanSpeed = speed;
        
        inputEl.value = ''; 
        updateSpeedOptionStyles(); 
        updateHashPowerDisplay();
        saveAppState();
        
        showFloatingAlert(`âœ… ${speed}x HÄ±z baÅŸarÄ±yla ${durationDays} gÃ¼nlÃ¼k sÃ¼reyle aktif edildi!`, 'success', 5000);
    } else {
        showFloatingAlert("GeÃ§ersiz Aktivasyon Key'i. LÃ¼tfen kontrol edin.", 'error');
    }
}

// =========================================================================
// DOM Ä°ÅLEMLERÄ° VE ARAYÃœZ YÃ–NETÄ°MÄ°
// =========================================================================

function showFloatingAlert(message, type = 'info', duration = 3000) {
    const alertEl = document.getElementById('floatingAlert');
    if (!alertEl) return;

    clearTimeout(alertTimeout);
    
    alertEl.className = '';
    alertEl.classList.add(`alert-${type}`);
    
    alertEl.innerText = message;
    alertEl.classList.add('show');

    alertTimeout = setTimeout(() => {
        alertEl.classList.remove('show');
    }, duration);
}

let cryptoDropdown, startBtn, stopBtn, transferBtn, hardwareIcon, hashFill, hashText, feedBox, countdownEl, miningStatusMessage, currentMiningBalance, individualBalances, selectMsg, settingsHeader, settingsContent, speedOptions, liveExchangeRates, miningArea;

function getDOMElements() {
    cryptoDropdown = document.getElementById("cryptoDropdown");
    startBtn = document.getElementById("startBtn");
    stopBtn = document.getElementById("stopBtn");
    transferBtn = document.getElementById("transferBtn");
    hardwareIcon = document.getElementById("hardwareIcon");
    hashFill = document.getElementById("hashFill");
    hashText = document.getElementById("hashText");
    feedBox = document.getElementById("feedBox");
    countdownEl = document.getElementById("countdown");
    miningStatusMessage = document.getElementById("miningStatusMessage");
    currentMiningBalance = document.getElementById("currentMiningBalance");
    individualBalances = document.getElementById("individualBalances");
    selectMsg = document.getElementById("selectMsg");
    settingsHeader = document.getElementById("settingsHeader");
    settingsContent = document.getElementById("settingsContent");
    speedOptions = document.getElementById("fanSpeedOptions");
    liveExchangeRates = document.getElementById("liveExchangeRates");
    miningArea = document.getElementById("miningArea");
}

function initializeUI() {
    getDOMElements(); 
    
    checkSpeedExpirations();
    
    cryptoDropdown.value = appState.selectedCrypto || "";
    
    updateSpeedOptionStyles();
    updateHashPowerDisplay();
    updateBalanceDisplay();
    updateMiningStatus(appState.mining); 
    
    if (appState.mining) {
        startMiningProcesses();
    }
    
    startPriceUpdate();
    
    startBtn.addEventListener('click', handleStartMining);
    stopBtn.addEventListener('click', handleStopMining);
    transferBtn.addEventListener('click', handleTransferBalance);
    cryptoDropdown.addEventListener('change', handleCryptoChange);
    settingsHeader.addEventListener('click', handleSettingsToggle);
    
    speedOptions.querySelectorAll('.speed-item').forEach(item => {
        item.addEventListener('click', (event) => {
            if (event.target.type !== 'text' && event.target.tagName !== 'BUTTON') {
                handleSpeedChange.call(item);
            }
        });
    });

    document.querySelectorAll('.bottom-menu a').forEach(link => {
        link.addEventListener('click', function() {
             document.querySelectorAll('.bottom-menu a').forEach(a => a.classList.remove('active'));
             this.classList.add('active');
        });
    });
}

function updateHashPowerDisplay() {
    const effectiveHashPower = appState.hashPower * appState.fanSpeed;
    hashText.innerText = `Aktif Hash GÃ¼cÃ¼: ${effectiveHashPower.toFixed(0)} KH/s (Ã‡arpan: ${appState.fanSpeed}x)`;
    hashFill.style.width = Math.min((effectiveHashPower / 20000) * 100, 100) + "%"; 
}

function updateSpeedOptionStyles() {
    const isMining = appState.mining;
    
    speedOptions.querySelectorAll('.speed-item').forEach(item => {
        const speed = parseInt(item.getAttribute('data-speed'));
        const radio = item.querySelector('input[type="radio"]');
        const activationArea = item.querySelector('.activation-area');
        const durationDays = KEY_DURATIONS[speed];
        
        const purchasedItem = appState.purchasedSpeeds.find(item => item.speed === speed);
        const isPurchased = !!purchasedItem;
        const isExpired = purchasedItem && purchasedItem.expiry !== 0 && purchasedItem.expiry < Date.now();
        
        item.classList.remove("active", "mining-active", "locked");
        if (activationArea) activationArea.style.display = 'none';

        if (!isPurchased || isExpired) {
            item.classList.add("locked");
            radio.disabled = true;
            if (activationArea) activationArea.style.display = 'flex';
            
            const label = item.querySelector('label');
            const originalText = `YÃ¼ksek HÄ±z (${speed}x)`;
            
            if (isExpired) {
                 label.innerHTML = `<input type="radio" name="fanSpeed" value="${speed}" disabled> ${originalText} <span style="color:#ff0057; font-size:11px; font-weight:900;">(SÃ¼re Doldu!)</span>`;
            } else if (speed !== 5) {
                 label.innerHTML = `<input type="radio" name="fanSpeed" value="${speed}" disabled> ${originalText} <span style="color:#ff9800; font-size:11px; font-weight:900;">(${durationDays} GÃ¼n Key Gerekli)</span>`;
            }

        } else {
            radio.disabled = false;
            if (purchasedItem.expiry !== 0) {
                 const remainingTime = purchasedItem.expiry - Date.now();
                 const days = Math.floor(remainingTime / DAY_MS);
                 const hours = Math.floor((remainingTime % DAY_MS) / (1000 * 60 * 60));
                 const label = item.querySelector('label');
                 const originalText = `YÃ¼ksek HÄ±z (${speed}x)`;
                 label.innerHTML = `<input type="radio" name="fanSpeed" value="${speed}"> ${originalText} <span style="color:#00b0ff; font-size:11px; font-weight:900;">(${days}g ${hours}s KaldÄ±)</span>`;

            }
        }

        if (isMining) {
             item.classList.add("mining-active");
             radio.checked = (speed === appState.fanSpeed);
        } else {
             if (speed === appState.fanSpeed) {
                item.classList.add("active");
                radio.checked = true;
            } else {
                radio.checked = false;
            }
        }
    });
}

function handleCryptoChange() {
    const newCrypto = cryptoDropdown.value;
    if (newCrypto === appState.selectedCrypto) return;

    if (appState.mining) {
        selectMsg.style.color = "#ff0057";
        selectMsg.innerText = "Kripto deÄŸiÅŸtirmek iÃ§in Ã¶nce kazÄ±mÄ± durdurun!";
        cryptoDropdown.value = appState.selectedCrypto; 
        return;
    }

    appState.selectedCrypto = newCrypto;
    appState.miningBalance = 0; 
    updateBalanceDisplay();
    saveAppState();
    
    if (appState.selectedCrypto) {
        selectMsg.style.color = "#00e676";
        showFloatingAlert(`${CRYPTOS[appState.selectedCrypto].emoji} KazÄ±m hedefi ayarlandÄ±: ${appState.selectedCrypto}`, 'success');
        selectMsg.innerText = `${CRYPTOS[appState.selectedCrypto].emoji} KazÄ±m hedefi ayarlandÄ±: ${appState.selectedCrypto}`;
    } else {
        selectMsg.style.color = "#ff9800";
        selectMsg.innerText = "LÃ¼tfen bir kripto seÃ§in!";
    }
}

function handleSettingsToggle() {
    if (appState.mining) {
        showFloatingAlert("Aktif kazÄ±m sÄ±rasÄ±nda ayarlar kilitlidir.", 'error');
        return;
    }
    settingsContent.classList.toggle('open');
    settingsHeader.classList.toggle('open');
}

function handleSpeedChange() {
    const item = this; 
    const speed = parseInt(item.getAttribute('data-speed'));
    
    const purchasedItem = appState.purchasedSpeeds.find(s => s.speed === speed);
    const isPurchased = !!purchasedItem;
    const isExpired = purchasedItem && purchasedItem.expiry !== 0 && purchasedItem.expiry < Date.now();
    
    if (appState.mining) {
         showFloatingAlert("HÄ±z deÄŸiÅŸtirmek iÃ§in lÃ¼tfen Ã¶nce kazÄ±mÄ± durdurun!", 'error');
         return;
    }
    
    if (!isPurchased || isExpired) {
        showFloatingAlert("Bu hÄ±z aktif deÄŸil. LÃ¼tfen Key girerek aktif edin.", 'error', 4000);
        speedOptions.querySelector(`[data-speed="${appState.fanSpeed}"] input`).checked = true;
        updateSpeedOptionStyles();
        return;
    }

    appState.fanSpeed = speed;
    updateSpeedOptionStyles(); 
    updateHashPowerDisplay();
    
    showFloatingAlert(`Yeni DonanÄ±m Ã‡arpanÄ± ayarlandÄ±: ${appState.fanSpeed}x`, 'info');
    saveAppState();
}

function handleStartMining(){
    if(!appState.selectedCrypto || appState.selectedCrypto === ""){
        showFloatingAlert("LÃ¼tfen Ã¶nce KazÄ±m Hedefini seÃ§in!", 'error');
        return;
    }
    if(appState.mining) return;
    
    appState.mining = true;
    startMiningProcesses();
    updateMiningStatus(true);
    showFloatingAlert(`${appState.selectedCrypto} KazÄ±mÄ± BaÅŸlatÄ±ldÄ±!`, 'success', 3500);
    selectMsg.innerText = "";
    saveAppState();
}

function handleStopMining() {
    appState.mining = false;
    stopMiningProcesses();
    updateMiningStatus(false);
    showFloatingAlert("KazÄ±m baÅŸarÄ±yla durduruldu. DonanÄ±m boÅŸta.", 'info');
    selectMsg.style.color = "#00e676";
    selectMsg.innerText = "KazÄ±m baÅŸarÄ±yla durduruldu. DonanÄ±m boÅŸta.";
    saveAppState();
}

function handleTransferBalance() {
    const transferredAmount = parseFloat(appState.miningBalance.toFixed(8)); 
    const selectedCrypto = appState.selectedCrypto;

    if(transferredAmount <= 0.00000001 || !selectedCrypto) {
        showFloatingAlert("AktarÄ±lacak bakiyeniz bulunmamaktadÄ±r.", 'error');
        return;
    }

    const currentMainBalance = appState.mainBalance[selectedCrypto] || 0;
    const newMainBalance = parseFloat((currentMainBalance + transferredAmount).toFixed(8));
    
    appState.mainBalance[selectedCrypto] = newMainBalance; 
    appState.miningBalance = 0; 
    
    updateBalanceDisplay();
    saveAppState(); 
    
    addFeed(`â¡ï¸ ${transferredAmount.toFixed(8)} ${selectedCrypto} bakiye, gÃ¼venli cÃ¼zdana aktarÄ±ldÄ±.`);
    showFloatingAlert(`BaÅŸarÄ±lÄ±! ${transferredAmount.toFixed(8)} ${selectedCrypto} ana cÃ¼zdana aktarÄ±ldÄ±.`, 'success', 4000);
}

function updateMiningStatus(isActive) {
    const cryptoEmoji = appState.selectedCrypto && CRYPTOS[appState.selectedCrypto] ? CRYPTOS[appState.selectedCrypto].emoji : '';
    
    cryptoDropdown.disabled = isActive;
    updateSpeedOptionStyles(); 

    settingsHeader.classList.toggle('locked', isActive);
    
    if (isActive) {
        settingsContent.classList.remove("open"); 
        miningStatusMessage.innerHTML = `${cryptoEmoji} AKTÄ°F | Hedef: ${appState.selectedCrypto} (Ã‡arpan: ${appState.fanSpeed}x)`;
        miningStatusMessage.style.background = "#00331a";
        miningStatusMessage.style.color = "#00e676";
        startBtn.style.display = 'none'; 
        stopBtn.style.display = 'flex'; 
        
        miningArea.style.animation = `pulse 2s infinite ease-in-out`; 

    } else {
        miningStatusMessage.innerText = "KazÄ±m KapalÄ±. DonanÄ±m BoÅŸta.";
        miningStatusMessage.style.background = "#333";
        miningStatusMessage.style.color = "#ff0057";
        countdownEl.innerText = "KazÄ±m BaÅŸlatÄ±lmayÄ± Bekliyor";
        startBtn.style.display = 'flex'; 
        stopBtn.style.display = 'none'; 
        
        miningArea.style.animation = 'none';
        miningArea.style.boxShadow = 'inset 0 0 30px rgba(0, 230, 118, 0.4), 0 0 20px rgba(0, 230, 118, 0.6)';
    }
}

function startMiningProcesses() {
    stopMiningProcesses(); 
    
    mineInterval = setInterval(mineLoop, 1000); 
    countdownInterval = setInterval(countdownLoop, 1000);
}

function stopMiningProcesses() {
    clearInterval(mineInterval);
    clearInterval(countdownInterval);
    mineInterval = null;
    countdownInterval = null;
    
    saveAppState();
}

function mineLoop(){
  if(!appState.mining || !appState.selectedCrypto) return;
  
  const selectedCrypto = appState.selectedCrypto;
  const difficulty = DIFFICULTY[selectedCrypto];
  
  const baseRate = (appState.hashPower * appState.fanSpeed) / difficulty; 
  const randomness = (Math.random() * 0.4) + 0.8; 
  
  const gain = (baseRate * randomness);
  
  appState.miningBalance = parseFloat((appState.miningBalance + gain).toFixed(8));
  
  updateHashPowerDisplay();
  
  if (appState.countdownTime % 5 === 0) {
      addFeed(`âœ… +${gain.toFixed(8)} ${selectedCrypto} kazÄ±ldÄ±.`);
  }
  updateBalanceDisplay();
  
  if (appState.countdownTime % 30 === 0) {
      saveAppState();
  }
}

function countdownLoop(){
  if(appState.countdownTime <= 0){
      showFloatingAlert("12 Saatlik KazÄ±m DÃ¶ngÃ¼sÃ¼ TamamlandÄ±! LÃ¼tfen tekrar baÅŸlatÄ±n.", 'error', 5000);
      countdownEl.innerText = "KazÄ±m DÃ¶ngÃ¼sÃ¼ TamamlandÄ±! LÃ¼tfen tekrar baÅŸlatÄ±n.";
      appState.mining = false;
      stopMiningProcesses();
      
      appState.countdownTime = MINING_CYCLE_SECONDS; 
      
      saveAppState();
      updateMiningStatus(false);
      return;
  }
  
  appState.countdownTime--;
  
  let h = String(Math.floor(appState.countdownTime / 3600)).padStart(2, "0");
  let m = String(Math.floor((appState.countdownTime % 3600) / 60)).padStart(2, "0");
  let s = String(appState.countdownTime % 60).padStart(2, "0");
  
  countdownEl.innerText = `Kalan SÃ¼re: ${h}:${m}:${s}`;
}

function addFeed(text){
  const line=document.createElement("div");
  line.className="feed-line";
  line.innerText=`[${new Date().toLocaleTimeString('tr-TR')}] ${text}`;
  feedBox.prepend(line);
  if(feedBox.children.length > 20) {
      feedBox.removeChild(feedBox.lastChild);
  }
}

function updateLivePrices() {
    let html = '';
    let totalValueUSD = 0;

    for (const crypto in LIVE_PRICES) {
        if (crypto !== 'USDT') {
            const currentData = LIVE_PRICES[crypto];
            const currentPrice = currentData.price;
            
            const changeAmount = (Math.random() - 0.5) * currentPrice * 0.015;
            const newPrice = Math.max(0.0001, currentPrice + changeAmount); 
            
            const percentChange = ((newPrice - currentData.lastPrice) / currentData.lastPrice) * 100;

            currentData.price = newPrice;
            currentData.change = percentChange;
        }
    }
    
    for (const crypto in LIVE_PRICES) {
        const data = LIVE_PRICES[crypto];
        const price = data.price;
        const change = data.change;
        const cryptoInfo = CRYPTOS[crypto] || {};

        totalValueUSD += (appState.mainBalance[crypto] || 0) * price;
        
        const changeClass = change >= 0 ? 'positive' : 'negative';
        const changeSign = change >= 0 ? 'â–²' : 'â–¼';

        html += `
            <div class="exchange-item">
                <span class="crypto-label"><i class="${cryptoInfo.icon}" style="color:${cryptoInfo.color}; margin-right:8px;"></i> ${crypto}</span>
                <span class="price-value">$${price.toFixed(crypto === 'BTC' ? 0 : 4)}</span>
                <span class="change-percent ${changeClass}">${changeSign} ${Math.abs(change).toFixed(2)}%</span>
            </div>
        `;
    }

    liveExchangeRates.innerHTML = html;
    
    const totalBalanceWallet = document.getElementById("totalBalanceWallet");
    if(totalBalanceWallet) totalBalanceWallet.innerText = `$${totalValueUSD.toFixed(2)}`; 
    
    updateBalanceDisplay();
    
    for (const crypto in LIVE_PRICES) {
        LIVE_PRICES[crypto].lastPrice = LIVE_PRICES[crypto].price;
    }
}

function startPriceUpdate() {
    updateLivePrices(); 
    priceUpdateInterval = setInterval(updateLivePrices, PRICE_UPDATE_INTERVAL); 
}

function updateBalanceDisplay(){
  let totalUSDTEquivalent = 0; 
  individualBalances.innerHTML = "";
  
  for (const crypto in appState.mainBalance) {
      const balance = appState.mainBalance[crypto] || 0;
      const priceData = LIVE_PRICES[crypto] || { price: 0 };
      const price = priceData.price;
      
      totalUSDTEquivalent += balance * price; 
      
      const icon = CRYPTOS[crypto] ? CRYPTOS[crypto].icon : 'fas fa-coins';

      individualBalances.innerHTML += `
        <p style="color:#00b0ff;"><i class="${icon}" style="color:${CRYPTOS[crypto].color}; margin-right:5px;"></i> ${crypto}: <span style="color:#e0e0e0; font-weight:700;">${balance.toFixed(8)}</span> (DeÄŸer: $${(balance * price).toFixed(2)})</p>
      `;
  }
  
  const miningPrice = LIVE_PRICES[appState.selectedCrypto] ? LIVE_PRICES[appState.selectedCrypto].price : 0;
  const miningValueUSD = appState.miningBalance * miningPrice;
  currentMiningBalance.innerHTML = `${appState.miningBalance.toFixed(8)} ${appState.selectedCrypto || 'Koin SeÃ§ilmedi'} <span style="font-size:16px;">($${miningValueUSD.toFixed(4)})</span>`;
  
  transferBtn.disabled = appState.miningBalance <= 0.00000001 || !appState.selectedCrypto; 

  const totalBalanceWallet = document.getElementById("totalBalanceWallet");
  if(totalBalanceWallet) totalBalanceWallet.innerText = `$${totalUSDTEquivalent.toFixed(2)}`; 
}

// =========================================================================
// KRÄ°TÄ°K BAÅLANGIÃ‡ NOKTASI
// =========================================================================

document.addEventListener('DOMContentLoaded', () => {
    checkUserAuthentication();
    initializeUI();
    showFloatingAlert("MiningPRO Kontrol Paneli BaÅŸlatÄ±ldÄ±.", 'info', 3000);
});

window.onbeforeunload = saveAppState;
</script>
</body>
</html>
