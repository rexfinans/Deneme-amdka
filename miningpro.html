<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MiningPRO - Profesyonel Kripto Kazƒ±m Sim√ºlasyonu</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
<style>
/* ========================================================================= */
/* --- GENEL STƒ∞LLER ve RESET --- */
/* ========================================================================= */
body, html{
  margin:0; padding:0;
  font-family: 'Roboto', sans-serif;
  background: #121212; 
  color:#e0e0e0;
  min-height:100vh;
  padding-bottom: 70px; 
}
* { box-sizing: border-box; }

header{
  background:#1f1f1f;
  padding:15px;
  text-align:center;
  font-size:28px;
  font-weight:900;
  color:#00e676; 
  text-shadow: 0 0 15px rgba(0, 230, 118, 0.6);
  box-shadow:0 5px 20px rgba(0,0,0,0.7);
  position:sticky;
  top:0;
  z-index:100;
}
header i { margin-right: 10px; color:#00b0ff; }

/* Wrapper */
.wrapper{
  max-width:550px;
  margin:20px auto;
  padding:0 15px;
}

/* ========================================================================= */
/* --- KARTLAR (CARD) ve DURUM --- */
/* ========================================================================= */
.card{
  background:#1f1f1f;
  border-radius:15px;
  padding:25px;
  margin-bottom:25px;
  box-shadow:0 8px 30px rgba(0,0,0,0.6);
  border: 1px solid #333;
}

.card h2 {
    color: #00b0ff; 
    font-size: 22px;
    margin-bottom: 20px;
    border-bottom: 2px solid #333;
    padding-bottom: 10px;
    font-weight: 700;
}
.card h3 {
    color: #e0e0e0;
    font-size: 17px;
    margin-top: 15px;
    margin-bottom: 10px;
    font-weight: 700;
}

/* Input/Select Stili */
.input-group { margin-bottom: 20px; }
.input-group label {
    display: block; margin-bottom: 8px; font-weight: 700; color: #a0a0a0;
}
.input-group input[type="text"], .input-group input[type="password"] {
    width: 100%; padding: 14px; font-size: 16px; border-radius: 10px;
    border: 2px solid #ff9800;
    background: #121212; color: #e0e0e0;
    font-weight: 700;
    transition: border-color 0.3s;
}
.key-input-group {
    display: flex; gap: 10px;
}

select{
  width:100%; padding:14px; font-size:16px; border-radius:10px;
  border:2px solid #ff9800; 
  background:#121212; color:#e0e0e0; appearance: none;
  font-weight: 700;
  transition: border-color 0.3s;
}
.select-wrapper { position: relative; }
.select-wrapper::after {
    content: '\f078'; font-family: 'Font Awesome 6 Free'; font-weight: 900;
    position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
    color: #ff9800; pointer-events: none;
}
select:disabled { opacity: 0.8; cursor: not-allowed; background: #2a2a2a; }


/* ========================================================================= */
/* --- FAN VE ANƒ∞MASYON --- */
/* ========================================================================= */
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.mining-area{
  margin:20px 0; height:160px;
  display:flex; justify-content:center; align-items:center;
  background:#121212;
  border-radius:15px; border: 4px solid #00e676;
  box-shadow: inset 0 0 30px rgba(0, 230, 118, 0.4), 0 0 15px rgba(0, 230, 118, 0.4);
}

#fanIcon {
    color: #00b0ff; 
    text-shadow: 0 0 20px #00b0ff;
    font-size: 90px;
    animation: none; 
    transition: color 0.3s;
}

/* Durum mesajƒ± */
.status-msg{
    text-align:center; font-weight:900; margin-bottom:15px;
    padding: 10px; border-radius: 8px;
    font-size: 18px;
}

/* ========================================================================= */
/* --- HASH BAR VE ZAMANLAYICI --- */
/* ========================================================================= */
.hash-container{ margin-top:25px; }
.hash-bar{
  width:100%; height:25px;
  background:#333; border-radius:12px; overflow:hidden;
  box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
}
.hash-fill{
  height:100%; width:0%;
  background:linear-gradient(90deg, #00e676, #ff9800);
  transition:width .5s ease-out;
}
.hash-text{
  text-align:center; margin-top:10px; font-size:16px;
  font-weight: 700; color: #a0a0a0;
}

.countdown{
  text-align:center; margin-top:20px; font-size:26px;
  font-weight:900; color:#ff9800;
  text-shadow: 0 0 8px rgba(255, 152, 0, 0.6);
}

/* ========================================================================= */
/* --- BUTONLAR VE BAKƒ∞YE --- */
/* ========================================================================= */
.button-container {
    display: flex;
    gap: 15px;
    margin-top: 25px;
}
.main-action-button{
  flex-grow: 1;
  padding:15px; border:none;
  border-radius:10px; font-weight:900; font-size:17px;
  color:#121212; cursor:pointer;
  transition: all .3s;
}
#startBtn { 
    background:#00e676; 
    box-shadow:0 5px 20px rgba(0, 230, 118, 0.5);
}
#stopBtn { 
    background: #ff0057; 
    box-shadow: 0 5px 20px rgba(255, 0, 87, 0.5);
    display: none;
}
.main-action-button:hover:not(:disabled){
  transform: translateY(-3px);
  filter: brightness(1.1);
}
.main-action-button:disabled { 
    opacity: 0.5; 
    cursor: not-allowed; 
    box-shadow: none; 
}


.balance-container{
    background:#2a2a2a; border-radius:10px; padding:20px;
    margin-top:25px; font-weight:700; 
    border: 2px solid #00b0ff;
    display: flex; justify-content: space-between; align-items: center;
    font-size: 16px;
}
.balance-container strong { 
    color: #ff9800; 
    font-size: 24px; 
    margin-left: 8px; 
}

#transferBtn { 
    background: #ff9800; 
    color: #121212; 
    box-shadow: 0 4px 15px rgba(255, 152, 0, 0.5);
    padding: 10px 15px;
    font-size: 15px;
    font-weight: 900;
    width: auto;
    margin-top: 0;
}
#transferBtn:disabled {
    background: #555;
    color: #ccc;
}


/* ========================================================================= */
/* --- AYARLAR VE HIZ SE√áƒ∞Mƒ∞ --- */
/* ========================================================================= */
.accordion-header {
    display: flex; justify-content: space-between; align-items: center;
    padding: 15px 0; border-bottom: 1px dashed #333;
    cursor: pointer; color: #00e676; font-size: 18px; font-weight: 900;
    transition: color 0.3s;
}
.accordion-header i { transition: transform 0.3s; }
.accordion-header.open i { transform: rotate(180deg); color: #00b0ff; }
.accordion-header.locked { 
    opacity: 0.6; 
    cursor: not-allowed; 
    color: #ff0057; 
}
.accordion-content {
    max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out;
    padding-top: 0;
}
.accordion-content.open {
    max-height: 1200px; /* Key ve Hƒ±z Listesi i√ßin geni≈ületildi */
    padding-top: 15px;
}

/* Hƒ±z Se√ßenekleri */
.speed-options { display: flex; flex-direction: column; gap: 10px; }
.speed-options.hidden { display: none; } /* Key girilmeden gizli kalacak */

.speed-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 15px; background: #2a2a2a; border-radius: 10px;
    font-weight: 700; border: 2px solid transparent; transition: all 0.2s;
    cursor: pointer; 
}
.speed-item.active {
    background: #3a3a3a;
    border-color: #00e676; 
    color: #00e676;
}
.speed-item.mining-active {
    opacity: 0.7; 
    pointer-events: none; 
}
.speed-item label { flex-grow: 1; cursor: inherit; display: flex; align-items: center; }
.speed-item input[type="radio"] { margin-right: 12px; transform: scale(1.3); pointer-events: none; }
.speed-item button { 
    background: #ff0057; 
    color: white; 
    border: none; 
    padding: 5px 10px; 
    border-radius: 5px; 
    font-size: 12px;
    display: none;
}
.speed-item.locked {
    background: #252525;
    color: #a0a0a0;
    cursor: not-allowed;
    border-color: #555;
}
.speed-item.locked button {
    display: block; 
}

/* C√ºzdan ve Feed Stilleri */
#individualBalances p { margin-bottom: 8px; font-weight: 500; }
.feed-box{
  height:120px; overflow-y:auto;
  background:#121212; border-radius:8px; padding:10px;
  font-size:14px; margin-top:15px; border: 1px solid #333;
}
.feed-line{ margin-bottom:4px; color:#00e676; }


/* ========================================================================= */
/* --- BORSA PANELƒ∞ (GELƒ∞≈ûMƒ∞≈û) --- */
/* ========================================================================= */
.exchange-panel {
    background: #1f1f1f;
    border: 3px solid #00b0ff;
    padding: 20px;
    border-radius: 15px;
    margin-top: 25px;
    box-shadow: 0 0 15px rgba(0, 176, 255, 0.4);
}
.exchange-panel h2 {
    color: #00b0ff;
    text-align: center;
    border-bottom: 2px dashed #333;
    margin-bottom: 15px;
}
.exchange-item {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr; 
    gap: 10px;
    padding: 10px 0;
    border-bottom: 1px dotted #2a2a2a;
    font-weight: 500;
    font-size: 15px;
    align-items: center;
}
.exchange-item:last-child {
    border-bottom: none;
}
.exchange-header {
    font-weight: 900;
    color: #a0a0a0;
    padding-bottom: 5px;
    font-size: 13px;
    border-bottom: 1px solid #444;
}
.crypto-label { 
    font-weight: 700; 
    color: #e0e0e0;
    display: flex;
    align-items: center;
}
.price-value {
    color: #00e676; 
    font-weight: 900;
    text-align: right;
}
.change-percent {
    text-align: right;
    font-weight: 700;
}
.positive { color: #00e676; }
.negative { color: #ff0057; }


/* ========================================================================= */
/* --- ALT MEN√ú VE UYARI Sƒ∞STEMƒ∞ --- */
/* ========================================================================= */
.bottom-menu { 
    position:fixed; bottom:0; left:0; width:100%; display:flex; justify-content:space-around;
    background:#161b22; 
    padding:10px 0; 
    box-shadow:0 -5px 15px rgba(0,0,0,0.5); 
    z-index:99;
}
.bottom-menu a {
    flex:1; text-decoration: none; text-align: center; margin:0 5px; padding:8px 0;
    font-size:12px; background:transparent; 
    color:#777; 
    border-radius:8px; 
    transition:.3s;
    font-weight: 600; 
}
.bottom-menu a i { 
    font-size: 20px; 
    display: block; 
    margin-bottom: 4px; 
}
.bottom-menu a.active { 
    color:#00bfff; 
}
/* Ekran √úst√º Uyarƒ± Sistemi */
#floatingAlert {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(-100px);
    z-index: 1000;
    padding: 15px 25px;
    border-radius: 10px;
    font-weight: 700;
    color: #121212;
    box-shadow: 0 5px 20px rgba(0,0,0,0.4);
    transition: opacity 0.3s, transform 0.3s;
    opacity: 0;
    pointer-events: none;
}
#floatingAlert.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}
.alert-success { background: #00e676; }
.alert-error { background: #ff0057; }
.alert-warning { background: #ff9800; }
.alert-info { background: #00b0ff; }

/* Key Kontrol Butonu */
#activateKeyButton {
    background: #00b0ff; 
    color: #121212; 
    padding: 14px 15px; 
    border: none; 
    border-radius: 10px; 
    font-weight: 700; 
    cursor: pointer;
    transition: background 0.3s;
}
#activateKeyButton:hover { background: #33c4ff; }

</style>
</head>
<body>

<div id="floatingAlert" class="alert-info"></div>
<header><i class="fas fa-microchip"></i> MiningPRO</header>
<div class="wrapper">
  
<div class="card">
  <div class="accordion-header" id="settingsHeader">
      ‚öôÔ∏è Cihaz ve Kazƒ±m Ayarlarƒ±
      <i class="fas fa-chevron-down"></i>
  </div>
  
  <div class="accordion-content open" id="settingsContent">
      <div class="input-group">
          <label for="cryptoDropdown">Kazƒ±m Ba≈ülatƒ±lacak Kripto:</label>
          <div class="select-wrapper">
              <select id="cryptoDropdown">
                  <option value="">-- Hedef Kriptoyu Se√ßin --</option>
                  <option value="BTC">Bitcoin (BTC)</option>
                  <option value="ETH">Ethereum (ETH)</option>
                  <option value="USDT">Tether (USDT)</option>
                  <option value="BNB">Binance Coin (BNB)</option>
                  <option value="TRX">Tron (TRX)</option>
                  <option value="DOGE">Dogecoin (DOGE)</option>
                  <option value="TON">TON (The Open Network)</option>
              </select>
          </div>
      </div>
  
      <h3>Donanƒ±m √áarpanƒ± Aktivasyon Anahtarƒ±</h3>
      <div class="input-group key-input-group">
          <input type="password" id="speedKeyInput" placeholder="Aktivasyon Anahtarƒ±nƒ± Girin" maxlength="8">
          <button id="activateKeyButton">Uygula</button>
      </div>
      
      <h3>Donanƒ±m √áarpanƒ± (Mining Hƒ±zƒ±)</h3>
      <div class="speed-options hidden" id="fanSpeedOptions">
          <div class="speed-item active" data-speed="5" data-expiry="0">
              <label><input type="radio" name="fanSpeed" value="5" checked> Standart Hƒ±z (5x)</label>
          </div>
          <div class="speed-item locked" data-speed="7" data-expiry="3"> 
              <label><input type="radio" name="fanSpeed" value="7" disabled> Y√ºksek Hƒ±z (7x)</label>
              <button onclick="window.location.href='hizal.html'">Y√ºkselt</button>
          </div>
          <div class="speed-item locked" data-speed="10" data-expiry="7">
              <label><input type="radio" name="fanSpeed" value="10" disabled> Uzman Hƒ±z (10x)</label>
              <button onclick="window.location.href='hizal.html'">Y√ºkselt</button>
          </div>
          <div class="speed-item locked" data-speed="15" data-expiry="14">
              <label><input type="radio" name="fanSpeed" value="15" disabled> Ultra Hƒ±z (15x)</label>
              <button onclick="window.location.href='hizal.html'">Y√ºkselt</button>
          </div>
          <div class="speed-item locked" data-speed="20" data-expiry="30">
              <label><input type="radio" name="fanSpeed" value="20" disabled> Maksimum Hƒ±z (20x)</label>
              <button onclick="window.location.href='hizal.html'">Y√ºkselt</button>
          </div>
      </div>
  </div> </div>
<div id="selectMsg" class="status-msg" style="color:#ff9800;">L√ºtfen kazƒ±m yapmak istediƒüiniz kripto parayƒ± se√ßin.</div>

<div class="card" id="miningTab">
  <h2><i class="fas fa-cogs"></i> Aktif Kazƒ±m Durumu</h2>
  <div id="miningStatusMessage" class="status-msg" style="background:#333; color:#ff0057;">Kazƒ±m Kapalƒ±. Cihaz Bo≈üta.</div>
  
  <div class="mining-area">
      <i id="fanIcon" class="fas fa-fan"></i> 
  </div>
  
  <div class="hash-container">
    <div class="hash-bar"><div class="hash-fill" id="hashFill"></div></div>
    <div class="hash-text" id="hashText">Aktif Hash G√ºc√º: 0 KH/s (√áarpan: 5x)</div>
  </div>
  
  <div class="countdown" id="countdown">Kazƒ±m Ba≈ülatƒ±lmayƒ± Bekliyor</div>
  
  <div class="button-container">
    <button id="startBtn" class="main-action-button"><i class="fas fa-play"></i> Kazƒ±mƒ± Ba≈ülat</button>
    <button id="stopBtn" class="main-action-button"><i class="fas fa-stop"></i> Kazƒ±mƒ± Durdur</button>
  </div>

  <div class="balance-container">
      <span>Biriken Bakiye: <strong id="currentMiningBalance">0.00000</strong></span>
      <button id="transferBtn" disabled><i class="fas fa-exchange-alt"></i> C√ºzdana Aktar</button>
  </div>

  <h3>Canlƒ± Kazan√ß ƒ∞≈ülemleri</h3>
  <div class="feed-box" id="feedBox"></div>
</div>

<div class="card" id="walletTab">
    <h2><i class="fas fa-wallet"></i> Kullanƒ±labilir Bakiye</h2>
    <div class="balance-container" style="border-color:#00e676; background:#2a2a2a;">
        Toplam Deƒüer (USD Kar≈üƒ±lƒ±ƒüƒ±): <strong id="totalBalanceWallet">$0.00</strong>
    </div>
    <div id="individualBalances" style="margin-top:15px; padding:10px; border:1px dashed #333;">
        <p style="text-align:center; color:#ccc;">Y√ºkleniyor...</p>
        </div>
</div>

<div class="exchange-panel">
    <h2><i class="fas fa-chart-line"></i> Anlƒ±k Kripto Piyasasƒ±</h2>
    <div class="exchange-item exchange-header">
        <span>Kripto</span>
        <span style="text-align:right;">Fiyat (USD)</span>
        <span style="text-align:right;">Deƒüi≈üim (24s)</span>
    </div>
    <div id="liveExchangeRates">
        <p style="text-align:center; color:#ccc;">Veriler y√ºkleniyor...</p>
    </div>
</div>
</div>

<div class="bottom-menu">
  <a href="miningpro.html" class="active"><i class="fas fa-tachometer-alt"></i> Kazƒ±m</a>
  <a href="hizal.html"><i class="fas fa-bolt"></i> Hƒ±z Al</a>
  <a href="kazan.html"><i class="fas fa-trophy"></i> Kazan</a>
  <a href="c√ºzdanƒ±m.html"><i class="fas fa-wallet"></i> C√ºzdanƒ±m</a>
</div>
<script>
// =========================================================================
// YEREL DEPOLAMA (LOCAL STORAGE) ƒ∞LE VERƒ∞ Y√ñNETƒ∞Mƒ∞
// =========================================================================

// --- Ba≈ülangƒ±√ß Verileri ---
const initialData = {
    isLoggedIn: true, // Varsayƒ±lan olarak True (Giri≈ü sayfasƒ±ndan geliyormu≈ü gibi)
    selectedCrypto: "",
    mining: false,
    hashPower: 1000, 
    countdownTime: 24 * 60 * 60, // 24 saat varsayƒ±lan (saniye)
    // Ana c√ºzdan bakiyeleri
    mainBalance: { USDT: 100.00, BTC: 0.0005, ETH: 0.01, BNB: 0, TRX: 0, DOGE: 0, TON: 0 }, 
    miningBalance: 0, // Biriken kazƒ±m bakiyesi
    fanSpeed: 5, // Aktif hƒ±z √ßarpanƒ±
    // Satƒ±n alƒ±nmƒ±≈ü/Aktif hƒ±zlar (speed: √ßarpan, expiry: biti≈ü zamanƒ± Epoch MS)
    purchasedSpeeds: [{ speed: 5, expiry: 0 }] 
};

// --- Kripto Detaylarƒ± (ƒ∞konlar ve Renkler) ---
const CRYPTOS = { 
    USDT: { name: "Tether", emoji: "üíµ", icon: "fas fa-dollar-sign", color: "#26a69a" }, 
    BTC: { name: "Bitcoin", emoji: "‚Çø", icon: "fab fa-btc", color: "#f7931a" }, 
    ETH: { name: "Ethereum", emoji: "Œû", icon: "fab fa-ethereum", color: "#627EEA" }, 
    BNB: { name: "Binance Coin", emoji: "üü°", icon: "fas fa-coins", color: "#F0B90B" }, 
    TRX: { name: "Tron", emoji: "‚ö´", icon: "fas fa-dot-circle", color: "#FF060A" }, 
    DOGE: { name: "Dogecoin", emoji: "üê∂", icon: "fas fa-dog", color: "#C3A634" },
    TON: { name: "TON", emoji: "üü¶", icon: "fas fa-water", color: "#0098EA" }
};

// Sim√ºlasyon Zorluklarƒ± (Zorluk ne kadar y√ºksekse kazan√ß o kadar d√º≈ü√ºk)
const DIFFICULTY = {
    BTC: 9000000000,
    ETH: 7500000000,
    USDT: 150000000, 
    BNB: 500000000,
    TRX: 10000000,
    DOGE: 5000000,
    TON: 80000000
};

// --- Anahtar Kontrol√º ---
const KEY_CODES = {
    'TURBO_KEY': 7,
    'UZMAN_KEY': 10,
    'ULTRA_KEY': 15,
    'MAKS_KEY': 20
};
// Sim√ºlasyon Anahtarƒ± (KEY girilince t√ºm hƒ±zlarƒ± a√ßacak)
const SIMULATION_KEY = 'PROMINER'; 


// Canlƒ± Fiyat Sim√ºlasyonu (ba≈ülangƒ±√ß fiyatlarƒ±)
let LIVE_PRICES = {
    USDT: { price: 1.00, change: 0.00, lastPrice: 1.00 }, 
    BTC: { price: 68542.12, change: 0.00, lastPrice: 68542.12 }, 
    ETH: { price: 3780.45, change: 0.00, lastPrice: 3780.45 }, 
    BNB: { price: 612.30, change: 0.00, lastPrice: 612.30 }, 
    TRX: { price: 0.12, change: 0.00, lastPrice: 0.12 }, 
    DOGE: { price: 0.16, change: 0.00, lastPrice: 0.16 },
    TON: { price: 5.50, change: 0.00, lastPrice: 5.50 }
};
const PRICE_UPDATE_INTERVAL = 15000; // 15 saniyede bir g√ºncelleme


let appState = {}; 
let mineInterval = null;
let countdownInterval = null;
let priceUpdateInterval = null; 
let alertTimeout = null; 

// =========================================================================
// YEREL DEPOLAMA VE BA≈ûLANGI√á
// =========================================================================

function loadAppState() {
    try {
        const storedData = localStorage.getItem('miningProState');
        if (storedData) {
            const parsedData = JSON.parse(storedData);
            
            // Satƒ±n alƒ±nmƒ±≈ü hƒ±zlarƒ±n formatƒ±nƒ± kontrol et ve 5x'i garanti et
            let finalSpeeds = parsedData.purchasedSpeeds || initialData.purchasedSpeeds;
            if (finalSpeeds.length === 0 || !finalSpeeds.find(s => s.speed === 5)) {
                 // 5x'i garanti et
                 finalSpeeds.push({ speed: 5, expiry: 0 });
            }

            appState = { 
                ...initialData, 
                ...parsedData,
                mainBalance: { ...initialData.mainBalance, ...parsedData.mainBalance },
                purchasedSpeeds: finalSpeeds.filter(s => s.speed !== undefined)
            };
        } else {
            appState = { ...initialData };
        }
        
    } catch (e) {
        console.error("Yerel depolama verisi y√ºklenirken hata:", e);
        appState = { ...initialData };
    }
}

function saveAppState() {
    try {
        localStorage.setItem('miningProState', JSON.stringify(appState));
    } catch (e) {
        console.error("Yerel depolama verisi kaydedilirken hata:", e);
    }
}

// =========================================================================
// Gƒ∞Rƒ∞≈û VE G√úVENLƒ∞K KONTROL√ú (ƒ∞stenen √∂zellik)
// =========================================================================
/**
 * Kullanƒ±cƒ±nƒ±n giri≈ü yapƒ±p yapmadƒ±ƒüƒ±nƒ± kontrol eder ve y√∂nlendirir.
 */
function checkLoginStatus() {
    loadAppState(); 
    if (!appState.isLoggedIn) {
        showFloatingAlert("Oturum bulunamadƒ±. L√ºtfen giri≈ü yapƒ±n.", 'error', 5000); 
        setTimeout(() => {
             // window.location.href = 'index.html'; // Ger√ßekte olmasƒ± gereken
             // Sim√ºlasyon i√ßin: index.html yerine 'false' d√∂nd√ºr√ºl√ºr
        }, 100); 
        return false;
    }
    return true;
}

// =========================================================================
// HIZ S√úRESƒ∞ KONTROL√ú (Yeni √∂zellik)
// =========================================================================
/**
 * S√ºresi dolan hƒ±zlarƒ± appState'ten √ßƒ±karƒ±r ve varsayƒ±lan hƒ±za d√∂ner.
 */
function checkSpeedExpirations() {
    const now = Date.now();
    let speedChanged = false;

    // S√ºresi dolan hƒ±zlarƒ± filtrele
    const validSpeeds = appState.purchasedSpeeds.filter(item => {
        // 5x (expiry: 0) kalƒ±cƒ±dƒ±r, kontrol etme
        if (item.expiry === 0) return true;

        if (item.expiry < now) {
            // S√ºresi dolan hƒ±z
            if (item.speed === appState.fanSpeed) {
                appState.fanSpeed = 5;
                showFloatingAlert(`${item.speed}x hƒ±z s√ºreniz doldu! Hƒ±zƒ±nƒ±z 5x'e d√º≈ü√ºr√ºld√º.`, 'warning', 7000);
                speedChanged = true;
            }
            return false; // Kaldƒ±rƒ±lacak
        }
        return true; // Kaldƒ±rƒ±lmayacak
    });

    appState.purchasedSpeeds = validSpeeds;
    
    if (speedChanged) {
        updateHashPowerDisplay();
        updateSpeedOptionStyles();
    }
    saveAppState();
}


// =========================================================================
// UYARI Sƒ∞STEMƒ∞ (FLOATING ALERT)
// =========================================================================

function showFloatingAlert(message, type = 'info', duration = 3000) {
    const alertEl = document.getElementById('floatingAlert');
    if (!alertEl) return;

    clearTimeout(alertTimeout);
    
    alertEl.className = '';
    alertEl.classList.add(`alert-${type}`);
    
    alertEl.innerText = message;
    alertEl.classList.add('show');

    alertTimeout = setTimeout(() => {
        alertEl.classList.remove('show');
    }, duration);
}


// =========================================================================
// DOM VE UI
// =========================================================================

let cryptoDropdown, startBtn, stopBtn, transferBtn, fanIcon, hashFill, hashText, feedBox, countdownEl, miningStatusMessage, currentMiningBalance, individualBalances, selectMsg, settingsHeader, settingsContent, speedOptions, liveExchangeRates, speedKeyInput, activateKeyButton;

function getDOMElements() {
    cryptoDropdown = document.getElementById("cryptoDropdown");
    startBtn = document.getElementById("startBtn");
    stopBtn = document.getElementById("stopBtn");
    transferBtn = document.getElementById("transferBtn");
    fanIcon = document.getElementById("fanIcon");
    hashFill = document.getElementById("hashFill");
    hashText = document.getElementById("hashText");
    feedBox = document.getElementById("feedBox");
    countdownEl = document.getElementById("countdown");
    miningStatusMessage = document.getElementById("miningStatusMessage");
    currentMiningBalance = document.getElementById("currentMiningBalance");
    individualBalances = document.getElementById("individualBalances");
    selectMsg = document.getElementById("selectMsg");
    settingsHeader = document.getElementById("settingsHeader");
    settingsContent = document.getElementById("settingsContent");
    speedOptions = document.getElementById("fanSpeedOptions");
    liveExchangeRates = document.getElementById("liveExchangeRates");
    speedKeyInput = document.getElementById("speedKeyInput");
    activateKeyButton = document.getElementById("activateKeyButton");
}

function initializeUI() {
    getDOMElements(); 
    
    checkSpeedExpirations();
    
    cryptoDropdown.value = appState.selectedCrypto || "";
    
    updateSpeedOptionStyles();
    updateHashPowerDisplay();
    updateBalanceDisplay();
    updateMiningStatus(appState.mining); 
    
    // Hƒ±z se√ßenekleri, ba≈ülangƒ±√ßta satƒ±n alƒ±nmƒ±≈ü hƒ±zlar varsa a√ßƒ±k g√∂r√ºn√ºr
    if (appState.purchasedSpeeds.length > 1) {
        speedOptions.classList.remove("hidden");
        speedKeyInput.disabled = true;
        activateKeyButton.disabled = true;
        speedKeyInput.placeholder = "Hƒ±z paketleriniz aktif.";
    }
    
    if (appState.mining) {
        startMiningProcesses();
    }
    
    startPriceUpdate();
    
    startBtn.addEventListener('click', handleStartMining);
    stopBtn.addEventListener('click', handleStopMining);
    transferBtn.addEventListener('click', handleTransferBalance);
    cryptoDropdown.addEventListener('change', handleCryptoChange);
    settingsHeader.addEventListener('click', handleSettingsToggle);
    activateKeyButton.addEventListener('click', handleKeyActivation);
    
    speedOptions.querySelectorAll('.speed-item').forEach(item => {
        item.addEventListener('click', handleSpeedChange);
    });

    // Men√º aktifliƒüini ayarlama
    const path = window.location.pathname;
    const currentPage = path.substring(path.lastIndexOf('/') + 1);
    document.querySelectorAll('.bottom-menu a').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === currentPage || (currentPage === "" && link.getAttribute('href') === 'miningpro.html')) {
            link.classList.add('active');
        }
    });
}

// =========================================================================
// KEY VE HIZ Kƒ∞Lƒ∞Dƒ∞ MANTIKLARI (Yeni √∂zellik)
// =========================================================================

function handleKeyActivation() {
    const key = speedKeyInput.value.trim().toUpperCase();
    
    if (key === SIMULATION_KEY) {
        // T√ºm hƒ±zlarƒ± aktif etme sim√ºlasyonu (30 g√ºnl√ºk s√ºre ile)
        const speedsToUnlock = [7, 10, 15, 20];
        const now = Date.now();
        const thirtyDays = 30 * 24 * 60 * 60 * 1000;
        let newSpeedsAdded = false;

        speedsToUnlock.forEach(speed => {
            if (!appState.purchasedSpeeds.find(item => item.speed === speed)) {
                appState.purchasedSpeeds.push({
                    speed: speed,
                    expiry: now + thirtyDays 
                });
                newSpeedsAdded = true;
            }
        });
        
        speedOptions.classList.remove("hidden");
        speedKeyInput.disabled = true;
        activateKeyButton.disabled = true;
        speedKeyInput.value = '';
        speedKeyInput.placeholder = "T√ºm hƒ±z paketleri aktif edildi.";
        
        updateSpeedOptionStyles();
        saveAppState();
        
        showFloatingAlert("üîë T√ºm hƒ±z paketleri ba≈üarƒ±yla 30 g√ºnl√ºƒü√ºne AKTƒ∞F EDƒ∞LDƒ∞!", 'success', 5000);
        
    } else {
        showFloatingAlert("Hatalƒ± Anahtar. L√ºtfen ge√ßerli bir kod giriniz.", 'error');
    }
}


// =========================================================================
// BORSA VE Fƒ∞YAT MANTIKLARI
// =========================================================================

function updateLivePrices() {
    let html = '';
    let totalValueUSD = 0;

    // Fiyatlarƒ± hafif√ße g√ºncelle ve deƒüi≈üimi hesapla
    for (const crypto in LIVE_PRICES) {
        if (crypto !== 'USDT') {
            const currentData = LIVE_PRICES[crypto];
            const currentPrice = currentData.price;
            
            // Fiyatƒ± g√ºncelle (%1'e kadar deƒüi≈üim)
            const changeAmount = (Math.random() - 0.5) * currentPrice * 0.005; 
            const newPrice = Math.max(0.0001, currentPrice + changeAmount); 
            
            // Y√ºzde deƒüi≈üimi hesapla (y√ºzde cinsinden)
            const percentChange = ((newPrice - currentData.lastPrice) / currentData.lastPrice) * 100;

            currentData.price = newPrice;
            currentData.change = percentChange;
        }
    }
    
    // Borsa panelini g√ºncelle
    for (const crypto in LIVE_PRICES) {
        const data = LIVE_PRICES[crypto];
        const price = data.price;
        const change = data.change;
        const cryptoInfo = CRYPTOS[crypto] || {};

        totalValueUSD += (appState.mainBalance[crypto] || 0) * price;
        
        const changeClass = change >= 0 ? 'positive' : 'negative';
        const changeSign = change >= 0 ? '‚ñ≤' : '‚ñº';
        
        const iconStyle = `style="color:${cryptoInfo.color}; margin-right:8px;"`;

        html += `
            <div class="exchange-item">
                <span class="crypto-label"><i class="${cryptoInfo.icon}" ${iconStyle}></i> ${crypto}</span>
                <span class="price-value">$${price.toFixed(crypto === 'BTC' ? 2 : 4)}</span>
                <span class="change-percent ${changeClass}">${changeSign} ${Math.abs(change).toFixed(2)}%</span>
            </div>
        `;
    }

    liveExchangeRates.innerHTML = html;
    
    updateBalanceDisplay();
    
    // Bir sonraki d√∂ng√º i√ßin mevcut fiyatlarƒ± lastPrice olarak kaydet 
    for (const crypto in LIVE_PRICES) {
        LIVE_PRICES[crypto].lastPrice = LIVE_PRICES[crypto].price;
    }
}

function startPriceUpdate() {
    updateLivePrices(); 
    priceUpdateInterval = setInterval(updateLivePrices, PRICE_UPDATE_INTERVAL); 
}


// =========================================================================
// TEMEL KAZIM MANTIKLARI
// =========================================================================

function updateHashPowerDisplay() {
    // Hash g√ºc√º hesaplanƒ±rken aktif hƒ±z √ßarpanƒ± kullanƒ±lƒ±r.
    const maxHash = 20000;
    const currentHash = appState.hashPower * appState.fanSpeed;
    
    hashText.innerText = `Aktif Hash G√ºc√º: ${currentHash.toFixed(0)} KH/s (√áarpan: ${appState.fanSpeed}x)`;
    hashFill.style.width = Math.min((currentHash / maxHash) * 100, 100) + "%"; 
}

function updateSpeedOptionStyles() {
    const isMining = appState.mining;
    
    speedOptions.querySelectorAll('.speed-item').forEach(item => {
        const speed = parseInt(item.getAttribute('data-speed'));
        const radio = item.querySelector('input[type="radio"]');
        
        // Hƒ±zƒ±n satƒ±n alƒ±nƒ±p alƒ±nmadƒ±ƒüƒ±nƒ± ve s√ºresinin dolup dolmadƒ±ƒüƒ±nƒ± kontrol et
        const purchasedItem = appState.purchasedSpeeds.find(item => item.speed === speed);
        const isPurchased = !!purchasedItem;
        const isExpired = purchasedItem && purchasedItem.expiry !== 0 && purchasedItem.expiry < Date.now();
        
        item.classList.remove("active", "mining-active", "locked");
        item.querySelector('button').style.display = 'none';

        if (!isPurchased || isExpired) {
            item.classList.add("locked");
            radio.disabled = true;
            item.querySelector('button').style.display = 'block';
            
            const label = item.querySelector('label');
            const originalText = label.innerText.split('(')[0].trim();
            
            if (isExpired) {
                 label.innerHTML = `<input type="radio" name="fanSpeed" value="${speed}" disabled> ${originalText} (${speed}x) <span style="color:#ff0057; font-size:11px; margin-left: 5px;">(S√ºre Doldu!)</span>`;
            } else {
                 label.innerHTML = `<input type="radio" name="fanSpeed" value="${speed}" disabled> ${originalText} (${speed}x)`;
            }

        } else {
            radio.disabled = false;
            // Kalan s√ºreyi g√∂ster
            if (purchasedItem.expiry !== 0) {
                 const remainingTime = purchasedItem.expiry - Date.now();
                 const days = Math.floor(remainingTime / (1000 * 60 * 60 * 24));
                 const hours = Math.floor((remainingTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                 
                 const label = item.querySelector('label');
                 const originalText = label.innerText.split('(')[0].trim();
                 label.innerHTML = `<input type="radio" name="fanSpeed" value="${speed}"> ${originalText} (${speed}x) <span style="color:#ff9800; font-size:11px; margin-left: 5px;">(${days}g ${hours}s Kaldƒ±)</span>`;

            }
        }

        if (isMining) {
             item.classList.add("mining-active");
             radio.checked = (speed === appState.fanSpeed);
        } else {
             if (speed === appState.fanSpeed) {
                item.classList.add("active");
                radio.checked = true;
            } else {
                radio.checked = false;
            }
        }
    });
}

function handleCryptoChange() {
    const newCrypto = cryptoDropdown.value;
    if (newCrypto === appState.selectedCrypto) return;

    if (appState.mining) {
        selectMsg.style.color = "#ff0057";
        selectMsg.innerText = "Kripto deƒüi≈ütirmek i√ßin √∂nce kazƒ±mƒ± durdurun!";
        cryptoDropdown.value = appState.selectedCrypto; 
        return;
    }

    appState.selectedCrypto = newCrypto;
    appState.miningBalance = 0; 
    updateBalanceDisplay();
    saveAppState();
    
    if (appState.selectedCrypto) {
        selectMsg.style.color = "#00e676";
        showFloatingAlert(`${CRYPTOS[appState.selectedCrypto].emoji} Kazƒ±m hedefi ayarlandƒ±: ${appState.selectedCrypto}`, 'success');
        selectMsg.innerText = `${CRYPTOS[appState.selectedCrypto].emoji} Kazƒ±m hedefi ayarlandƒ±: ${appState.selectedCrypto}`;
    } else {
        selectMsg.style.color = "#ff9800";
        selectMsg.innerText = "L√ºtfen bir kripto se√ßin!";
    }
}

function handleSettingsToggle() {
    if (appState.mining) {
        showFloatingAlert("Aktif kazƒ±m sƒ±rasƒ±nda ayarlar kilitlidir.", 'error');
        return;
    }
    const isOpen = settingsContent.classList.toggle('open');
    settingsHeader.classList.toggle('open', isOpen);
}

function handleSpeedChange(event) {
    const item = event.currentTarget; 
    const speed = parseInt(item.getAttribute('data-speed'));
    
    const purchasedItem = appState.purchasedSpeeds.find(item => item.speed === speed);
    const isPurchased = !!purchasedItem;
    const isExpired = purchasedItem && purchasedItem.expiry !== 0 && purchasedItem.expiry < Date.now();
    
    if (appState.mining) {
         showFloatingAlert("Hƒ±z deƒüi≈ütirmek i√ßin l√ºtfen √∂nce kazƒ±mƒ± durdurun!", 'error');
         return;
    }
    
    if (!isPurchased || isExpired) {
        showFloatingAlert("Bu hƒ±zƒ±n s√ºresi dolmu≈ü veya satƒ±n alƒ±nmamƒ±≈ü! Y√ºkselt butonuna tƒ±klayƒ±n.", 'warning', 4000);
        speedOptions.querySelector(`[data-speed="${appState.fanSpeed}"] input`).checked = true;
        updateSpeedOptionStyles();
        return;
    }

    appState.fanSpeed = speed;
    updateSpeedOptionStyles(); 
    updateHashPowerDisplay();
    
    showFloatingAlert(`Yeni Donanƒ±m √áarpanƒ± ayarlandƒ±: ${appState.fanSpeed}x`, 'info');
    saveAppState();
}

function handleStartMining(){
    if(!appState.selectedCrypto || appState.selectedCrypto === ""){
        showFloatingAlert("L√ºtfen √∂nce Kazƒ±m Hedefini se√ßin!", 'warning');
        return;
    }
    if(appState.mining) return;
    
    appState.mining = true;
    // 24 saatlik d√∂ng√º her ba≈üladƒ±ƒüƒ±nda sƒ±fƒ±rlanƒ±r
    appState.countdownTime = 24 * 60 * 60; 
    startMiningProcesses();
    updateMiningStatus(true);
    showFloatingAlert(`${appState.selectedCrypto} Kazƒ±mƒ± Ba≈ülatƒ±ldƒ±! ƒ∞yi kazan√ßlar.`, 'success', 3500);
    selectMsg.innerText = "";
    saveAppState();
}

function handleStopMining() {
    appState.mining = false;
    stopMiningProcesses();
    updateMiningStatus(false);
    showFloatingAlert("Kazƒ±m ba≈üarƒ±yla durduruldu. Cihaz bo≈üta.", 'info');
    selectMsg.style.color = "#00e676";
    selectMsg.innerText = "Kazƒ±m ba≈üarƒ±yla durduruldu. Cihaz bo≈üta.";
    saveAppState();
}

/**
 * ƒ∞stenen √∂zellik: Biriken bakiyeyi ana c√ºzdana aktarma.
 */
function handleTransferBalance() {
    const transferredAmount = parseFloat(appState.miningBalance.toFixed(8)); 
    const selectedCrypto = appState.selectedCrypto;

    if(transferredAmount <= 0.00000001 || !selectedCrypto) {
        showFloatingAlert("Aktarƒ±lacak bakiyeniz bulunmamaktadƒ±r.", 'error');
        return;
    }

    // Bakiye Aktarƒ±mƒ±
    const currentMainBalance = appState.mainBalance[selectedCrypto] || 0;
    const newMainBalance = parseFloat((currentMainBalance + transferredAmount).toFixed(8));
    
    appState.mainBalance[selectedCrypto] = newMainBalance; 
    appState.miningBalance = 0; 
    
    updateBalanceDisplay();
    saveAppState(); 
    
    addFeed(`‚û°Ô∏è ${transferredAmount.toFixed(8)} ${selectedCrypto} bakiye, g√ºvenli c√ºzdana aktarƒ±ldƒ±.`);
    showFloatingAlert(`Ba≈üarƒ±lƒ±! ${transferredAmount.toFixed(8)} ${selectedCrypto} ana c√ºzdana aktarƒ±ldƒ±.`, 'success', 4000);
}

function updateMiningStatus(isActive) {
    const cryptoEmoji = appState.selectedCrypto && CRYPTOS[appState.selectedCrypto] ? CRYPTOS[appState.selectedCrypto].emoji : '';
    
    cryptoDropdown.disabled = isActive;
    updateSpeedOptionStyles(); 

    settingsHeader.classList.toggle('locked', isActive);
    
    if (isActive) {
        settingsContent.classList.remove("open"); 
        miningStatusMessage.innerHTML = `${cryptoEmoji} **AKTƒ∞F** | Hedef: ${appState.selectedCrypto} (√áarpan: ${appState.fanSpeed}x)`;
        miningStatusMessage.style.background = "#00331a";
        miningStatusMessage.style.color = "#00e676";
        startBtn.style.display = 'none'; 
        stopBtn.style.display = 'flex'; 
        
        // Hƒ±z √ßarpanƒ±na g√∂re fan d√∂n√º≈ü hƒ±zƒ± ayarlanƒ±r (√ñrn: 20x hƒ±z -> 0.75s, 5x hƒ±z -> 3s)
        fanIcon.style.animation = `spin ${15 / appState.fanSpeed}s linear infinite`; 
        fanIcon.style.color = CRYPTOS[appState.selectedCrypto].color;

    } else {
        miningStatusMessage.innerText = "Kazƒ±m Kapalƒ±. Cihaz Bo≈üta.";
        miningStatusMessage.style.background = "#333";
        miningStatusMessage.style.color = "#ff0057";
        countdownEl.innerText = "Kazƒ±m Ba≈ülatƒ±lmayƒ± Bekliyor";
        startBtn.style.display = 'flex'; 
        stopBtn.style.display = 'none'; 
        
        fanIcon.style.animation = 'none';
        fanIcon.style.color = "#00b0ff";
    }
}

function startMiningProcesses() {
    stopMiningProcesses(); 
    
    mineInterval = setInterval(mineLoop, 1000); 
    countdownInterval = setInterval(countdownLoop, 1000);
}

function stopMiningProcesses() {
    clearInterval(mineInterval);
    clearInterval(countdownInterval);
    mineInterval = null;
    countdownInterval = null;
    
    saveAppState();
}

function mineLoop(){
  if(!appState.mining || !appState.selectedCrypto) return;
  
  const selectedCrypto = appState.selectedCrypto;
  const difficulty = DIFFICULTY[selectedCrypto];
  
  // Hash g√ºc√º, hƒ±z √ßarpanƒ± ve zorluk kullanƒ±larak baz kazan√ß hesaplanƒ±r.
  const baseRate = (appState.hashPower * appState.fanSpeed) / difficulty; 
  const randomness = (Math.random() * 0.4) + 0.8; // %20 varyasyon
  
  const gain = (baseRate * randomness);
  
  appState.miningBalance = parseFloat((appState.miningBalance + gain).toFixed(8));
  
  updateHashPowerDisplay();
  
  // Her 5 saniyede bir logla
  if (appState.countdownTime % 5 === 0) {
      addFeed(`‚úÖ +${gain.toFixed(8)} ${selectedCrypto} kazƒ±ldƒ±.`);
  }
  updateBalanceDisplay();
  
  // Her 30 saniyede bir kaydet
  if (appState.countdownTime % 30 === 0) {
      saveAppState();
  }
}

function countdownLoop(){
  if(appState.countdownTime <= 0){
      showFloatingAlert("24 Saatlik Kazƒ±m D√∂ng√ºs√º Tamamlandƒ±! L√ºtfen tekrar ba≈ülatƒ±n.", 'warning', 5000);
      countdownEl.innerText = "24 Saatlik Kazƒ±m D√∂ng√ºs√º Tamamlandƒ±! L√ºtfen tekrar ba≈ülatƒ±n.";
      appState.mining = false;
      stopMiningProcesses();
      
      appState.countdownTime = 24 * 60 * 60; 
      
      saveAppState();
      updateMiningStatus(false);
      return;
  }
  
  appState.countdownTime--;
  
  let h = String(Math.floor(appState.countdownTime / 3600)).padStart(2, "0");
  let m = String(Math.floor((appState.countdownTime % 3600) / 60)).padStart(2, "0");
  let s = String(appState.countdownTime % 60).padStart(2, "0");
  
  countdownEl.innerText = `Kalan S√ºre: ${h}:${m}:${s}`;
}

function addFeed(text){
  const line=document.createElement("div");
  line.className="feed-line";
  line.innerText=`[${new Date().toLocaleTimeString('tr-TR')}] ${text}`;
  feedBox.prepend(line);
  if(feedBox.children.length > 20) {
      feedBox.removeChild(feedBox.lastChild);
  }
}

function updateBalanceDisplay(){
  let totalUSDTEquivalent = 0; 
  individualBalances.innerHTML = "";
  
  for (const crypto in appState.mainBalance) {
      const balance = appState.mainBalance[crypto] || 0;
      const priceData = LIVE_PRICES[crypto] || { price: 0 };
      const price = priceData.price;
      
      totalUSDTEquivalent += balance * price; 
      
      const cryptoInfo = CRYPTOS[crypto] || {};
      const iconStyle = `style="color:${cryptoInfo.color}; margin-right:5px;"`;
      
      individualBalances.innerHTML += `
        <p style="color:#00b0ff;"><i class="${cryptoInfo.icon}" ${iconStyle}></i> ${crypto}: <span style="color:#e0e0e0; font-weight:700;">${balance.toFixed(8)}</span> (Deƒüer: $${(balance * price).toFixed(2)})</p>
      `;
  }
  
  const miningPrice = LIVE_PRICES[appState.selectedCrypto] ? LIVE_PRICES[appState.selectedCrypto].price : 0;
  const miningValueUSD = appState.miningBalance * miningPrice;
  currentMiningBalance.innerHTML = `${appState.miningBalance.toFixed(8)} ${appState.selectedCrypto || 'Koin Se√ßilmedi'} <span style="font-size:16px;">($${miningValueUSD.toFixed(4)})</span>`;
  
  // Aktar butonu: Yeterli bakiye varsa ve kripto se√ßiliyse aktif et
  transferBtn.disabled = appState.miningBalance <= 0.00000001 || !appState.selectedCrypto; 

  const totalBalanceWallet = document.getElementById("totalBalanceWallet");
  if(totalBalanceWallet) totalBalanceWallet.innerText = `$${totalUSDTEquivalent.toFixed(2)}`; 
}

// =========================================================================
// KRƒ∞Tƒ∞K BA≈ûLANGI√á NOKTASI
// =========================================================================

document.addEventListener('DOMContentLoaded', () => {
    // 1. Giri≈ü kontrol√ºn√º yap
    if (checkLoginStatus()) {
        // 2. Eƒüer kullanƒ±cƒ± giri≈ü yaptƒ±ysa, uygulamayƒ± ba≈ülat
        initializeUI();
    } else {
         // Giri≈ü yapƒ±lmamƒ±≈üsa UI elemanlarƒ± y√ºklenmez.
    }
});

window.onbeforeunload = saveAppState;
</script>
</body>
</html>
