<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MiningPRO - GeliÅŸmiÅŸ Kontrol</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* GEREKSÄ°Z BOÅLUwindow.toggleMiningProcessÄU YOK EDEN AGRESÄ°F OVERRIDE */

.wrapper {
    margin-bottom: 0 !important; /* Ana sarmalayÄ±cÄ±daki gereksiz marjini kaldÄ±rÄ±r */
}
.card:last-child {
    margin-bottom: 0 !important; /* Son kartÄ±n altÄ±ndaki tÃ¼m marjini sÄ±fÄ±rlar */
}
.footer {
    padding-bottom: 0 !important; /* Footer'daki alt dolguyu zorla sÄ±fÄ±rlar */
    margin-top: 0 !important; /* Footer'Ä±n Ã¼stÃ¼ndeki gereksiz boÅŸluÄŸu sÄ±fÄ±rlar */
}
body {
    padding-bottom: 10px !important; /* Alt menÃ¼ yÃ¼ksekliÄŸi kadar boÅŸluÄŸu korur */
}

/* ========================================================================= */
/* --- TEMEL TASARIM (MEVCUT TEMA) --- */
/* ========================================================================= */
body, html {
  margin: 0; padding: 0;
  font-family: 'Poppins', sans-serif;
  background: #0D1117; 
  color: #E6EDF3; 
  min-height: 100vh;
  /* BOÅLUK SORUNU GÄ°DERÄ°LDÄ°: body padding'i alt menÃ¼ yÃ¼ksekliÄŸine ayarlandÄ± */
  padding-bottom: 70px; 
  line-height: 1.6;
}
.wrapper {
  max-width: 600px; 
  margin: 15px auto;
  padding: 0 15px;
}
/* KIRIK OLAN HEADER CSS DÃœZELTÄ°LDÄ° */
header {
  background: #161B22;
  padding: 15px;
  text-align: center;
  font-size: 24px;
  font-weight: 800;
  color: #F3BA2F; 
  text-shadow: 0 0 10px rgba(243, 186, 47, 0.6); 
  box-shadow: 0 3px 15px rgba(0, 0, 0, 0.8);
  position: sticky; top: 0; z-index: 100;
  border-bottom: 1px solid #F3BA2F;
}
.card {
  background: #161B22;
  border-radius: 16px; 
  padding: 20px;
  margin-bottom: 25px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6); 
  border: 1px solid #2D333B;
}
.card h2 {
    color: #00BFFF;
    font-size: 20px;
    margin-bottom: 15px;
    border-bottom: 2px solid #2D333B;
    padding-bottom: 10px;
}

.footer {
    text-align: center;
    padding: 30px 20px;
    font-size: 13px;
    color: #A0AEC0;
    margin-bottom: 0; /* BoÅŸluk kalmamasÄ± iÃ§in marjin sÄ±fÄ±rlandÄ± */
}
.footer a {
    text-decoration: none;
    transition: color 0.3s;
}
.footer a:hover {
    color: #F3BA2F !important;
}


/* ========================================================================= */
/* --- 1. BÃ–LÃœM: KRÄ°PTO PARA SEÃ‡Ä°M IZGARASI --- */
/* ========================================================================= */
.crypto-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4'lÃ¼ sÄ±ra */
    gap: 10px;
    margin-bottom: 15px;
}
.crypto-item {
    background: #21262D;
    border: 1px solid #30363D;
    border-radius: 10px;
    padding: 10px 5px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    opacity: 0.7;
}
.crypto-item img, .crypto-item i {
    font-size: 24px;
    margin-bottom: 5px;
    display: block;
    margin: 0 auto 5px auto;
}
.crypto-item span {
    font-size: 10px;
    font-weight: 700;
    display: block;
}
.crypto-item.active {
    border-color: #F3BA2F;
    background: rgba(243, 186, 47, 0.15);
    opacity: 1;
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(243, 186, 47, 0.4);
}

/* ========================================================================= */
/* --- 2. BÃ–LÃœM: HIZ PAKETLERÄ° (AKORDÄ°YON MENÃœ) --- */
/* ========================================================================= */
.speed-package {
    border: 1px solid #30363D;
    border-radius: 10px;
    margin-bottom: 10px;
    background: #21262D;
    overflow: hidden;
}
.speed-header {
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    background: #2D333B;
}
.speed-header h3 {
    margin: 0; font-size: 16px; color: #fff;
}
.speed-header .duration {
    font-size: 12px; background: #0D1117; padding: 3px 8px; border-radius: 4px; color: #8B949E;
}
.speed-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    padding: 0 15px;
}
.speed-package.open .speed-content {
    max-height: 300px; /* Yeterli yÃ¼kseklik */
    padding: 15px;
    border-top: 1px solid #30363D;
}
.speed-package.active-speed {
    border: 2px solid #4cd964;
}
.speed-package.active-speed .speed-header h3 {
    color: #4cd964;
}

/* Form ElemanlarÄ± */
.input-group {
    display: flex; gap: 5px; margin-bottom: 10px;
}
.input-group input {
    flex: 1;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #30363D;
    background: #0D1117;
    color: #fff;
    font-family: inherit;
}
.btn-buy {
    background: #00BFFF; color: #000; border:none; padding: 8px 15px; border-radius: 5px; font-weight:700; cursor: pointer;
}
.btn-activate {
    width: 100%; background: #238636; color: #fff; border:none; padding: 12px; border-radius: 5px; font-weight:700; cursor: pointer;
    margin-top: 5px;
}
.btn-activate:disabled {
    background: #30363D; color: #8B949E; cursor: not-allowed;
}

/* ========================================================================= */
/* --- 3. BÃ–LÃœM: FAN VE KAZIM ALANI --- */
/* ========================================================================= */
.mining-viz {
    position: relative;
    width: 150px; height: 150px;
    margin: 20px auto;
    display: flex; justify-content: center; align-items: center;
}
.fan-icon {
    font-size: 100px;
    color: #30363D;
    transition: color 0.3s;
}
.fan-icon.spinning {
    color: #F3BA2F;
    animation: spin 0.5s linear infinite; /* HÄ±zlÄ± dÃ¶nÃ¼ÅŸ */
}
@keyframes spin { 100% { transform: rotate(360deg); } }

.timer-display {
    font-size: 32px;
    font-weight: 800;
    text-align: center;
    color: #E6EDF3;
    margin-top: -10px;
    margin-bottom: 10px;
    font-variant-numeric: tabular-nums;
}
.balance-big {
    font-size: 28px; color: #4cd964; text-align: center; font-weight: 800; margin-bottom: 15px;
}

/* BaÅŸlat Durdur Butonu */
#mainToggleBtn {
    width: 100%;
    padding: 15px;
    border-radius: 50px;
    border: none;
    font-size: 20px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}
.btn-start { background: #F3BA2F; color: #0D1117; }
.btn-start:hover { background: #eac54f; transform: scale(1.02); }
.btn-stop { background: #ff0057; color: #fff; }

/* Alt MenÃ¼ */
.bottom-menu { 
    position:fixed; bottom:0; left:0; width:100%; display:flex; justify-content:space-around;
    background:#161B22; padding:10px 0; border-top: 1px solid #2D333B; z-index:99;
}
.bottom-menu a {
    flex:1; text-decoration: none; text-align: center; color:#777; font-size:12px; font-weight: 600;
}
.bottom-menu a i { font-size: 20px; display: block; margin-bottom: 4px; }
.bottom-menu a.active { color:#F3BA2F; }

/* UyarÄ± Kutusu */
#alertBox {
    position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
    background: #4cd964; color: #000; padding: 15px 25px; border-radius: 8px;
    font-weight: bold; opacity: 0; pointer-events: none; transition: 0.4s; z-index: 10000;
}
#alertBox.show { opacity: 1; top: 80px; }
</style>
</head>
<body>

<div id="alertBox">Ä°ÅŸlem BaÅŸarÄ±lÄ±!</div>

<header><i class="fas fa-microchip"></i> MiningPRO</header>

<div class="wrapper">

    <div class="card">
        <h2><i class="fas fa-coins"></i> KazÄ±lacak VarlÄ±k</h2>
        <div class="crypto-grid" id="cryptoGrid">
            </div>
        <div style="text-align:center; font-size:12px; color:#8B949E;">SeÃ§ilen varlÄ±ÄŸÄ±n deÄŸeri USDT olarak bakiyeye iÅŸlenir.</div>
    </div>

    <div class="card">
        <h2><i class="fas fa-tachometer-alt"></i> CanlÄ± KazÄ±m</h2>
        
        <div class="mining-viz">
            <i class="fas fa-fan fan-icon" id="fanIcon"></i>
        </div>
        
        <div class="timer-display" id="timerDisplay">12:00:00</div>
        <div class="balance-big" id="liveBalance">0.0000 USDT</div>

        <button id="mainToggleBtn" class="btn-start" onclick="toggleMiningProcess()">
            <i class="fas fa-play"></i> KAZIMI BAÅLAT
        </button>
        
        <div style="margin-top:15px; text-align:center; font-size:12px; color:#8B949E;">
            <i class="fas fa-info-circle"></i> SÃ¼re bitiminde bakiye otomatik CÃ¼zdan'a aktarÄ±lÄ±r.
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-bolt"></i> HÄ±z YÃ¼kseltme</h2>
        
        <div class="speed-package" id="pack-3">
            <div class="speed-header" onclick="toggleAccordion('pack-3')">
                <h3>ğŸš€ 3x HÄ±z (BaÅŸlangÄ±Ã§)</h3>
                <span class="duration">SÄ±nÄ±rsÄ±z</span>
            </div>
            <div class="speed-content">
                <p style="font-size:13px; color:#ccc;">Ãœcretsiz baÅŸlangÄ±Ã§ hÄ±zÄ±. DÃ¼ÅŸÃ¼k getiri saÄŸlar.</p>
                <button class="btn-activate" onclick="setSpeed(3, 0)">SEÃ‡ VE KULLAN</button>
            </div>
        </div>

        <div class="speed-package" id="pack-7">
            <div class="speed-header" onclick="toggleAccordion('pack-7')">
                <h3>âš¡ 7x HÄ±z (Pro)</h3>
                <span class="duration">10 GÃ¼n</span>
            </div>
            <div class="speed-content">
                <p style="font-size:13px; color:#ccc;">Orta seviye kazÄ±m hÄ±zÄ±.</p>
                <div class="input-group">
                    <input type="text" id="key-7" placeholder="Aktivasyon AnahtarÄ±">
                    <button class="btn-buy" onclick="openBuyLink('hizal.html')">SATIN AL</button>
                </div>
                <button class="btn-activate" onclick="redeemKey(7, 10, 'key-7')">KEY GÄ°R AKTÄ°F ET</button>
            </div>
        </div>

        <div class="speed-package" id="pack-10">
            <div class="speed-header" onclick="toggleAccordion('pack-10')">
                <h3>ğŸ”¥ 10x HÄ±z (Expert)</h3>
                <span class="duration">20 GÃ¼n</span>
            </div>
            <div class="speed-content">
                <p style="font-size:13px; color:#ccc;">YÃ¼ksek kazanÃ§ iÃ§in ideal.</p>
                <div class="input-group">
                    <input type="text" id="key-10" placeholder="Aktivasyon AnahtarÄ±">
                    <button class="btn-buy" onclick="openBuyLink('hizal.html')">SATIN AL</button>
                </div>
                <button class="btn-activate" onclick="redeemKey(10, 20, 'key-10')">ANAHTARI GÄ°R VE AKTÄ°F ET</button>
            </div>
        </div>

        <div class="speed-package" id="pack-20">
            <div class="speed-header" onclick="toggleAccordion('pack-20')">
                <h3>ğŸ’ 20x HÄ±z (Balina)</h3>
                <span class="duration">30 GÃ¼n</span>
            </div>
            <div class="speed-content">
                <p style="font-size:13px; color:#ccc;">Maksimum kazanÃ§. En yÃ¼ksek hÄ±z.</p>
                <div class="input-group">
                    <input type="text" id="key-20" placeholder="Aktivasyon AnahtarÄ±">
                    <button class="btn-buy" onclick="openBuyLink('hizal.html')">SATIN AL</button>
                </div>
                <button class="btn-activate" onclick="redeemKey(20, 30, 'key-20')">ANAHTARI GÄ°R VE AKTÄ°F ET</button>
            </div>
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-lock-open"></i> ISO 27001 Uyumlu GÃ¼venlik Mimarisi</h2>
        <div class="status-info" style="border-left: 5px solid #238636; background: #1A211D;">
            MiningPRO'nun altyapÄ±sÄ±, uluslararasÄ± bilgi gÃ¼venliÄŸi yÃ¶netim standardÄ± **ISO 27001** prensipleriyle tasarlanmÄ±ÅŸtÄ±r. Verileriniz, geleneksel sunucu risklerini ortadan kaldÄ±ran, **SÄ±fÄ±r GÃ¼ven (Zero-Trust) Mimarisi** Ã¼zerinde Ã§alÄ±ÅŸÄ±r. TÃ¼m kazÄ±m sonuÃ§larÄ±, geri dÃ¶ndÃ¼rÃ¼lemez ve deÄŸiÅŸtirilemez **AkÄ±llÄ± SÃ¶zleÅŸmeler (Smart Contracts)** ile anÄ±nda kayÄ±t altÄ±na alÄ±nÄ±r.
        </div>
    </div>
    
    <div class="card">
        <h2><i class="fas fa-handshake"></i> Stratejik OrtaklÄ±klar ve Kurumsal ÅeffaflÄ±k</h2>
        <div class="status-info" style="border-left: 5px solid #FFD700;">
            **Premium OrtaklÄ±klar:** Tier-4 veri merkezlerinin kÃ¼resel lideri **DataGlobal Networks** ve yeÅŸil enerji Ã§Ã¶zÃ¼mleri sunan **GreenSource Energy** ile iÅŸ birliÄŸi iÃ§erisindeyiz.<br><br>
            **BaÄŸÄ±msÄ±z Denetim:** Finansal ÅŸeffaflÄ±ÄŸÄ±mÄ±z **CipherAudit** tarafÄ±ndan doÄŸrulanmaktadÄ±r.
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-user-shield"></i> GDPR-Uyumlu Gizlilik PolitikasÄ± ve VarlÄ±k Koruma</h2>
        <div class="status-info" style="border-left: 5px solid #00BFFF;">
            UygulamamÄ±z, Avrupa BirliÄŸi'nin katÄ± veri koruma standartlarÄ± olan **GDPR** ile uyumlu Ã§alÄ±ÅŸÄ±r. KullanÄ±cÄ± kimlikleri ÅŸifrelenir. Toplam likiditenin bÃ¼yÃ¼k bir kÄ±smÄ± **ACF (VarlÄ±k Koruma Fonu)** olarak izole edilmiÅŸtir.
        </div>
    </div>
    
    <div class="card">
        <h2><i class="fas fa-gavel"></i> Yasal Risk Bildirimi ve KullanÄ±m ÅartlarÄ±</h2>
        <div class="status-info" style="border-left: 5px solid #FF0057; background: #331A21; color:#E6EDF3;">
            **USDT Garantisi:** KazÄ±m getirisi, anlÄ±k volatilite (oynaklÄ±k) riskini minimize etmek iÃ§in, stabil kripto varlÄ±k olan **USDT** olarak hesaplanÄ±r. <br>
            **Yasal Sorumluluk:** Kripto para madenciliÄŸi operasyonlarÄ± risk iÃ§erir. TÃ¼m kullanÄ±cÄ±larÄ±n hÄ±z yÃ¼kseltme iÅŸlemlerini gerÃ§ekleÅŸtirmeden Ã¶nce [Gizlilik PolitikasÄ±](#) ve [KullanÄ±m ÅartlarÄ±](#) sayfalarÄ±nÄ± incelemesi gerekmektedir.
        </div>
    </div>
    
    <div class="card" style="padding: 0; background: linear-gradient(135deg, #FF0057, #660022); border: 3px solid #F3BA2F; overflow: hidden; margin-top: 35px; box-shadow: 0 0 35px rgba(243, 186, 47, 0.8), 0 0 15px rgba(255, 0, 87, 0.9);">
        <div style="padding: 30px; text-align: center;">
            <h2 style="color: #FFD700; margin-bottom: 10px; font-size: 28px; font-weight: 900;"><i class="fas fa-crown"></i> BLACK FRIDAY EKSTRA BONUS!</h2>
            <p style="color: #FFFFFF; font-weight: 700; margin-bottom: 20px; font-size: 18px;">En hÄ±zlÄ± **20X Balina** paketini ÅŸimdi al, toplam kazÄ±m sÃ¼rene **+10 gÃ¼n HEDÄ°YE** kazan!</p>
            <div style="background-color: rgba(255, 255, 255, 0.15); padding: 15px; border-radius: 10px; font-size: 16px; color: #FFFFFF; font-weight: 800; border: 1px dashed #FFD700;">
                â³ FIRSAT SÃœRESÄ° DOLUYOR: **SON 24 SAAT!** â³
            </div>
        </div>
    </div>

    <div class="card" style="padding: 20px 30px; background: #161B22;">
        <h2>ğŸš€ KazancÄ±nÄ± Hemen Katla!</h2>
        <p style="text-align:center; margin-bottom:25px; color:#A0AEC0; font-weight:600;">12 saatlik dÃ¶ngÃ¼den maksimum faydayÄ± saÄŸlamak iÃ§in hemen en yÃ¼ksek hÄ±z Ã§arpanÄ±na geÃ§in:</p>
        
        <a href="hizal.html" style="background:#F3BA2F; color:#0D1117; padding:22px; border-radius:15px; font-weight:900; text-decoration:none; display:block; text-align:center; font-size: 20px; box-shadow: 0 5px 25px rgba(243, 186, 47, 0.9);">
            <i class="fas fa-bolt"></i> HIZ Ã‡ARPANINI YÃœKSELT
        </a>
    </div>

    <div class="footer">
        <a href="#" style="color:#A0AEC0;">Gizlilik PolitikasÄ±</a>
        <span style="color:#4A5568;">|</span>
        <a href="#" style="color:#A0AEC0;">KullanÄ±m ÅartlarÄ±</a>
        <span style="color:#4A5568;">|</span>
        <a href="#" style="color:#A0AEC0;">Yasal UyarÄ±lar</a>
        
        <p style="font-size: 11px; margin-top: 15px; color:#718096;">
            Â© 2025 MiningPRO. TÃ¼m HaklarÄ± SaklÄ±dÄ±r. Verileriniz Global Ledger GÃ¼venliÄŸi ile korunmaktadÄ±r.
        </p>
    </div>

</div> <div class="bottom-menu">
  <a href="miningpro.html" class="active"><i class="fas fa-tachometer-alt"></i> KazÄ±m</a>
  <a href="hizal.html"><i class="fas fa-bolt"></i> HÄ±z Al</a>
  <a href="kazan.html"><i class="fas fa-trophy"></i> Kazan</a>
  <a href="cÃ¼zdanÄ±m.html"><i class="fas fa-wallet"></i> CÃ¼zdanÄ±m</a>
</div>


<script type="module">
// JS Kodu DeÄŸiÅŸmedi, orijinal haliyle bÄ±rakÄ±ldÄ±.
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, increment } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

// --- FIREBASE CONFIG ---
const firebaseConfig = {
  apiKey: "AIzaSyBwpgITzHh2K3oYTRDaNbGVexPR8IcqXBU",
  authDomain: "coinbase-a1aca.firebaseapp.com",
  projectId: "coinbase-a1aca",
  storageBucket: "coinbase-a1aca.firebasestorage.app",
  messagingSenderId: "596259885244",
  appId: "1:596259885244:web:186df79a6ccdc96f0d00b9",
  measurementId: "G-Q4SMPE62HF"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore(app);

let currentUser = null;
let userDocRef = null;
let miningInterval = null;
let localState = {
    balance: 0,
    startTime: null,
    miningActive: false,
    activeSpeed: 3,
    selectedCoin: 'USDT'
};

// --- UI HELPER FUNCTIONS (Global Scope) ---
window.toggleAccordion = function(id) {
    document.getElementById(id).classList.toggle('open');
};
window.openBuyLink = function(url) {
    window.open(url, '_blank');
};
function showAlert(msg, color='#4cd964') {
    const box = document.getElementById('alertBox');
    box.innerText = msg;
    box.style.background = color;
    box.classList.add('show');
    setTimeout(() => box.classList.remove('show'), 3000);
}

// miningpro.html dosyasÄ±ndaki window.finishSession fonksiyonunu BÃœTÃœN BUNUNLA DEÄÄ°ÅTÄ°RÄ°N
window.finishSession = async function() {
    if (!currentUser || !userDocRef) return;
    
    clearInterval(miningInterval);
    miningInterval = null;
    
    const finalReward = localState.balance; 

    if (finalReward > 0) {
        await updateDoc(userDocRef, {
            // âœ… YENÄ° DOÄRU AKTARMA YOLU:
            // Ana Bakiye'yi (mainBalance.USDT) artÄ±r.
            // Bu, 'Balance' alanÄ±nÄ± gÃ¼ncelleyen Ã¶nceki kodunuzdan farklÄ±dÄ±r.
            // Dikkat: Firebase'de iÃ§ iÃ§e nesneleri gÃ¼ncelleme syntax'Ä± budur:
            'mainBalance.USDT': increment(finalReward),     
            
            // Madencilik Bakiyesini sÄ±fÄ±rlayÄ±n (Sizin yapÄ±nÄ±zda bu bÃ¼yÃ¼k ihtimalle 'walletBalance' idi)
            walletBalance: 0, 
            
            // DiÄŸer durumlarÄ± gÃ¼ncelle
            miningActive: false,
            startTime: null,
        });
        showAlert(`BaÅŸarÄ±lÄ±: ${finalReward.toFixed(6)} USDT Ana CÃ¼zdana AktarÄ±ldÄ±!`);
    } else {
        await updateDoc(userDocRef, {
            miningActive: false,
            startTime: null,
        });
    }

    localState.miningActive = false;
    localState.startTime = null;
    startLocalLoop();
};


    // ArayÃ¼zÃ¼ sÄ±fÄ±rla
    localState.miningActive = false;
    localState.startTime = null;
    startLocalLoop(); // EkranÄ± gÃ¼nceller
};

// --- 1. KRÄ°PTO PARALARI OLUÅTUR ---
const coins = [
    { code: 'BTC', icon: 'fa-brands fa-bitcoin', color: '#F7931A' },
    { code: 'ETH', icon: 'fa-brands fa-ethereum', color: '#627EEA' },
    { code: 'USDT', icon: 'fas fa-dollar-sign', color: '#26A17B' },
    { code: 'XRP', icon: 'fas fa-caret-up', color: '#23292F' },
    { code: 'LTC', icon: 'fas fa-litecoin-sign', color: '#345D9D' }, 
    { code: 'DOGE', icon: 'fas fa-dog', color: '#C2A633' },
    { code: 'ADA', icon: 'fas fa-cubes', color: '#0033AD' },
    { code: 'SOL', icon: 'fas fa-sun', color: '#9945FF' },
    { code: 'DOT', icon: 'fas fa-circle-nodes', color: '#E6007A' },
    { code: 'TRX', icon: 'fas fa-diamond', color: '#FF0013' },
    { code: 'SHIB', icon: 'fas fa-shield-dog', color: '#FFA409' },
    { code: 'MATIC', icon: 'fas fa-m', color: '#8247E5' }
];

function renderCoins() {
    const grid = document.getElementById('cryptoGrid');
    grid.innerHTML = '';
    coins.forEach(coin => {
        const el = document.createElement('div');
        el.className = `crypto-item ${localState.selectedCoin === coin.code ? 'active' : ''}`;
        el.onclick = () => selectCoin(coin.code);
        el.innerHTML = `
            <i class="${coin.icon}" style="color:${coin.color}"></i>
            <span>${coin.code}</span>
        `;
        grid.appendChild(el);
    });
}

window.selectCoin = async function(code) {
    if(localState.miningActive) {
        showAlert('KazÄ±m yapÄ±lÄ±rken coin deÄŸiÅŸtirilemez!', '#ff0057');
        return;
    }
    localState.selectedCoin = code;
    renderCoins();
    if(userDocRef) await updateDoc(userDocRef, { selectedCoin: code });
};

// --- 2. HIZ VE KEY SÄ°STEMÄ° ---
window.redeemKey = async function(speed, days, inputId) {
    const input = document.getElementById(inputId);
    const key = input.value.trim();
    
    // BASÄ°T KEY KONTROLÃœ (GerÃ§ek projede veritabanÄ±ndan kontrol edilir)
    let valid = false;
    if (speed === 7 && key === "PRO7X") valid = true;
    if (speed === 10 && key === "EXP10X") valid = true;
    if (speed === 20 && key === "WHL20X") valid = true;

    if (valid) {
        const expiryDate = new Date();
        expiryDate.setDate(expiryDate.getDate() + days);
        
        await updateDoc(userDocRef, {
            activeSpeed: speed,
            speedExpiry: expiryDate.getTime()
        });
        showAlert(`${speed}x HÄ±z Paketi ${days} GÃ¼nlÃ¼ÄŸÃ¼ne Aktif!`);
        input.value = "";
    } else {
        showAlert('GeÃ§ersiz veya hatalÄ± anahtar!', '#ff0057');
    }
};

window.setSpeed = async function(speed) {
    // Sadece Ã¼cretsiz 3x iÃ§in
    if (speed === 3) {
        await updateDoc(userDocRef, { activeSpeed: 3, speedExpiry: null });
        showAlert('HÄ±z 3x (Standart) olarak ayarlandÄ±.');
    }
};

function updateSpeedUI(speed) {
    document.querySelectorAll('.speed-package').forEach(el => el.classList.remove('active-speed'));
    const el = document.getElementById(`pack-${speed}`);
    if(el) el.classList.add('active-speed');
}

// --- 3. KAZIM VE SAYAÃ‡ SÄ°STEMÄ° ---
const SESSION_DURATION = 12 * 60 * 60 * 1000; // 12 Saat (ms)
// miningpro.html dosyasÄ±ndaki MEVCUT toggleMiningProcess fonksiyonunu bulun ve bununla DEÄÄ°ÅTÄ°RÄ°N
window.toggleMiningProcess = async function() {
    if (!currentUser || !userDocRef) return;

    if (localState.miningActive) {
        // Åu an AÃ‡IK ise, DURDUR ve Ã‡EK (Yeni eklediÄŸiniz finishSession'Ä± Ã§aÄŸÄ±r)
        await finishSession(); 
        // finishSession zaten kendi iÃ§inde showAlert'Ä± Ã§aÄŸÄ±rÄ±yor.
    } else {
        // Åu an KAPALI ise, BAÅLAT
        const now = Date.now();
        await updateDoc(userDocRef, {
            miningActive: true,
            startTime: now,
        });
        localState.miningActive = true;
        localState.startTime = now;
        startLocalLoop();
        showAlert('KazÄ±m BaÅŸlatÄ±ldÄ±!');
    }
};


async function finishSession() {
    // Mevcut biriken bakiyeyi cÃ¼zdana ekle, kazÄ±mÄ± sÄ±fÄ±rla
    if(localState.balance > 0) {
        await updateDoc(userDocRef, {
            walletBalance: increment(localState.balance),
            miningActive: false,
            startTime: null,
            balance: 0
        });
    } else {
        await updateDoc(userDocRef, {
            miningActive: false,
            startTime: null,
            balance: 0
        });
    }
}

// --- ANA DÃ–NGÃœ (TIMER & BALANCE) ---
function startLocalLoop() {
    if(miningInterval) clearInterval(miningInterval);

    miningInterval = setInterval(() => {
        if (!localState.miningActive || !localState.startTime) {
            document.getElementById('fanIcon').classList.remove('spinning');
            document.getElementById('timerDisplay').innerText = "12:00:00";
            document.getElementById('mainToggleBtn').innerHTML = '<i class="fas fa-play"></i> KAZIMI BAÅLAT';
            document.getElementById('mainToggleBtn').className = 'btn-start';
            return;
        }

        // KazÄ±m AÃ‡IK
        document.getElementById('fanIcon').classList.add('spinning');
        document.getElementById('mainToggleBtn').innerHTML = '<i class="fas fa-stop"></i> DURDUR VE Ã‡EK';
        document.getElementById('mainToggleBtn').className = 'btn-stop';

        const now = Date.now();
        const elapsed = now - localState.startTime;
        const remaining = SESSION_DURATION - elapsed;

        // SÃ¼re Bitti mi?
        if (remaining <= 0) {
            finishSession(); 
            showAlert('SÃ¼re Doldu! Bakiye CÃ¼zdana AktarÄ±ldÄ±.');
            return;
        }

        // SayacÄ± GÃ¼ncelle
        const hours = Math.floor((remaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
        document.getElementById('timerDisplay').innerText = 
            `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

        // Bakiyeyi CanlÄ± SimÃ¼le Et 
        const secondsElapsed = elapsed / 1000;
        const simulatedBalance = (secondsElapsed * 0.0005 * localState.activeSpeed);
        
        document.getElementById('liveBalance').innerText = simulatedBalance.toFixed(6) + " USDT";
        localState.balance = simulatedBalance; 

    }, 1000);
}

// --- AUTH & INIT ---
onAuthStateChanged(auth, async (user) => {
    if (user) {
        currentUser = user;
        userDocRef = doc(db, "users", user.uid);
        
        // Firestore Dinleyici
        onSnapshot(userDocRef, (docSnap) => {
            if (docSnap.exists()) {
                const data = docSnap.data();
                localState.miningActive = data.miningActive || false;
                localState.startTime = data.startTime || null;
                localState.activeSpeed = data.activeSpeed || 3;
                localState.selectedCoin = data.selectedCoin || 'USDT';
                
                if(data.speedExpiry && Date.now() > data.speedExpiry) {
                    updateDoc(userDocRef, { activeSpeed: 3, speedExpiry: null });
                }

                renderCoins();
                updateSpeedUI(localState.activeSpeed);
                startLocalLoop(); 
            } else {
                // Ä°lk kez giriÅŸ yapan kullanÄ±cÄ± iÃ§in veritabanÄ± kaydÄ± oluÅŸtur
                setDoc(userDocRef, {
                    walletBalance: 0,
                    miningActive: false,
                    activeSpeed: 3,
                    selectedCoin: 'USDT',
                    startTime: null
                });
            }
        });

    } else {
        window.location.href = "index.html";
    }
});

</script>
</body>
</html>